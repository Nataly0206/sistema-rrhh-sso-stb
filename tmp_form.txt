    1 <!DOCTYPE html>
    2 <html lang="es">
    3 <head>
    4 <meta charset="utf-8" />
    5 <title>Identificación de Riesgo por Puesto</title>
    6 <style>
    7   :root{
    8     --border:#000;
    9     --gris:#bfbfbf;
   10     --font: "Arial", Helvetica, sans-serif;
   11   }
   12   *{ box-sizing:border-box; }
   13   body{ margin:0; font-family:var(--font); color:#000; }
   14   .a4{ width:210mm; margin:0 auto; padding:10mm 12mm; }
   15 
   16   /* Encabezado */
   17   .head{ display:flex; align-items:flex-start; gap:12px; }
   18   .head img{ height:48px; width:auto; object-fit:contain; margin-top:2px; }
   19   .head-text{ text-align:center; flex:1; line-height:1.2; font-size:12px; text-transform:uppercase; }
   20   .head-text .line1{ font-weight:700; }
   21   .head-hr{ border:none; border-top:1px solid var(--border); margin:6px 0 0; }
   22 
   23   /* Barras de sección */
   24   .bar{ background:var(--gris); color:#000; text-transform:uppercase; 
   25         font-weight:700; text-align:center; padding:6px; border:1px solid var(--border); }
   26 
   27   /* Tabla principal */
   28   table.sheet{ width:100%; border-collapse:collapse; table-layout:fixed; }
   29   .sheet td, .sheet th{ border:1px solid var(--border); vertical-align:top; }
   30   .label{ width:36%; padding:6px; font-size:12px; }
   31   .field{ width:64%; padding:0; }
   32 
   33   /* Campos (estilo “celda vacía”) */
   34   .cell-input, .cell-textarea{
   35     width:100%; border:0; padding:8px; font:inherit; resize:none; 
   36     outline:none; background:transparent;
   37   }
   38   .cell-textarea{ height:90px; } /* alto para “Descripción General de la labor” */
   39   .objetivo{ height:110px; }
   40 
   41   /* Imprime bonito */
   42   @media print{
   43     body{ margin:0; }
   44     .a4{ width:auto; padding:0; }
   45   }
   46   /* --- Ajustes globales (sin cambiar contenido) --- */
   47   /*.sheet col{ width:auto !important; }                 /* anula colgroups desparejos */
   48   .sheet{ table-layout:fixed; }                        /* grilla estable para imprimir */
   49   .sheet th, .sheet td{ padding:6px 8px; line-height:1.25; }
   50   .sheet th{ font-size:11px; }
   51   .sheet th, .sheet td{ white-space:normal; overflow-wrap:anywhere; word-break:normal; hyphens:auto; }
   52   .cell-input, .cell-textarea{ padding:6px 8px; }
   53 
   54   /* 7) Firmas/fechas: evita cortes raros en las etiquetas */
   55   .sheet .label-cell{ white-space:normal; }
   56 
   57   /* Poner TODAS las celdas TIPO en vertical */
   58 .risk-table td.tipo{
   59   writing-mode: vertical-rl;   /* texto de arriba hacia abajo */
   60   text-orientation: mixed;     /* mantiene letras latinas derechas */
   61   white-space: nowrap;         /* evita cortes o saltos raros */
   62   text-align: center;          /* centra horizontalmente */
   63   vertical-align: middle;      /* centra verticalmente (sobre el rowspan) */
   64   padding: 8px 4px;
   65 }
   66 
   67 /* Oculta los <br> dentro de la celda tipo para que sea una sola línea vertical */
   68 .risk-table td.tipo br{ display:none; }
   69 
   70 /* (Opcional) si quieres estrechar la primera columna:
   71 .risk-table td.tipo{ width:32px !important; }
   72 */
   73 
   74   /* Vertical abajo → arriba (letras derechas) */
   75   .risk-table td.tipo{
   76     writing-mode: vertical-rl;   /* columna vertical */
   77     text-orientation: mixed;     /* letras latinas derechas */
   78     transform: rotate(180deg);   /* invierte el sentido a abajo→arriba */
   79     white-space: nowrap;
   80     text-align: center;
   81     vertical-align: middle;
   82     padding: 8px 4px;
   83   }
   84   /* Re-endereza el texto dentro para que no quede cabeza abajo */
   85   .risk-table td.tipo .tipo-inner{
   86     display: inline-block;
   87     transform: rotate(180deg);
   88   }
   89   /* Opcional: ocultar <br> dentro de TIPO para que sea una sola línea vertical */
   90   .risk-table td.tipo br{ display:none; }
   91 
   92   /* Opcional: ajustar ancho de la columna TIPO si quieres más angosta */
   93   /* .risk-table td.tipo{ width:32px !important; } */
   94 
   95   .actions{ margin-top:12px; }
   96 .btn-guardar{
   97   display:block;
   98   width:100%;
   99   padding:12px 16px;
  100   font:700 16px var(--font);
  101   text-transform:uppercase;
  102   border:1px solid var(--border);
  103   border-radius:8px;
  104   background: linear-gradient(180deg, #2ea043, #1f7a35); /* verde agradable */
  105   color:;
  106   box-shadow: 0 2px 6px rgba(0,0,0,.15);
  107   cursor:pointer;
  108 }
  109 .btn-guardar:hover{ filter:brightness(1.05); }
  110 .btn-guardar:active{ transform:translateY(1px); box-shadow: 0 1px 4px rgba(0,0,0,.2); }
  111 .btn-guardar:disabled{
  112   background:#9ccaa8; color:#fff; cursor:not-allowed; box-shadow:none;
  113 }
  114 /* No mostrar al imprimir */
  115 @media print{ .actions{ display:none; } }
  116 </style>
  117 
  118 <script>
  119   // Envuelve el contenido actual de cada TIPO en un span (una sola vez)
  120   document.querySelectorAll('.risk-table td.tipo').forEach(td => {
  121     if (!td.querySelector('.tipo-inner')) {
  122       td.innerHTML = '<span class="tipo-inner">' + td.innerHTML + '</span>';
  123     }
  124   });
  125 </script>
  126 
  127 </head>
  128 <body>
  129 
  130 @if ($errors->any())
  131   <div style="margin:10px 0; padding:8px; border:1px solid #c00; color:#b00020;">
  132     @foreach ($errors->all() as $e)
  133       <div>• {{ $e }}</div>
  134     @endforeach
  135   </div>
  136 @endif
  137 
  138 @if (session('success'))
  139   <div style="margin:10px 0; padding:8px; border:1px solid #0a0; color:#0a0;">
  140     {{ session('success') }}
  141   </div>
  142 @endif
  143 
  144   <form id="riesgos-form"
  145       action="{{ route('identificacion.store') }}"
  146       method="POST"
  147       data-fetch-base="{{ url('/identificacion') }}">
  148   @csrf
  149   <div class="a4">
  150     <!-- ENCABEZADO -->
  151     <div class="head">
  152       <img src="{{ asset('img/logo.PNG') }}" alt="Logo">
  153       <div class="head-text">
  154         <div class="line1">Service and Trading Business S.A. de C.V.</div>
  155         <div>Proceso Salud y Seguridad Ocupacional / Health and Occupational Safety Process</div>
  156         <div>Identificación de riesgo por puesto de trabajo / Identification of risk by work position</div>
  157       </div>
  158     </div>
  159     <hr class="head-hr">
  160 
  161     <div class="bar">Datos Generales del Puesto</div>
  162 <table class="sheet">
  163   <colgroup><col style="width:36%"><col style="width:64%"></colgroup>
  164   <tr>
  165     <td class="label">Puesto de Trabajo Analizado</td>
  166     <td class="field">
  167       <input type="hidden" name="id_puesto_trabajo_matriz" id="puesto_id" value="{{ $id_puesto_trabajo_matriz ?? '' }}">
  168       <input type="text" id="puesto-input" list="puestos-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" value="{{ old('puesto_nombre') }}">
  169       <datalist id="puestos-list">
  170         @foreach ($puestos as $p)
  171           <option data-id="{{ $p->id_puesto_trabajo_matriz }}" value="{{ $p->puesto_trabajo_matriz }}"></option>
  172         @endforeach
  173       </datalist>
  174     </td>
  175   </tr>
  176 
  177   <tr>
  178     <td class="label">Departamento</td>
  179     <td class="field"><input class="cell-input" type="text" name="departamento" disabled></td>
  180   </tr>
  181 
  182   <tr>
  183     <td class="label">N° de empleados por puesto de trabajo</td>
  184     <td class="field">
  185       <input class="cell-input" type="number" min="0" name="ptm_num_empleados" value="{{ old('ptm_num_empleados') }}">
  186     </td>
  187   </tr>
  188 
  189   <tr>
  190     <td class="label">Descripción general del puesto</td>
  191     <td class="field">
  192       <textarea class="cell-input" name="ptm_descripcion_general" rows="3">{{ old('ptm_descripcion_general') }}</textarea>
  193     </td>
  194   </tr>
  195 
  196   <tr>
  197     <td class="label">Actividades diarias</td>
  198     <td class="field">
  199       <textarea class="cell-input" name="ptm_actividades_diarias" rows="3">{{ old('ptm_actividades_diarias') }}</textarea>
  200     </td>
  201   </tr>
  202 
  203   <tr>
  204     <td class="label">Objetivo del puesto</td>
  205     <td class="field">
  206       <textarea class="cell-input objetivo" name="ptm_objetivo_puesto" rows="3">{{ old('ptm_objetivo_puesto') }}</textarea>
  207     </td>
  208   </tr>
  209 </table>
  210 
  211     <!-- === estilos mínimos extra (si aún no los tienes) === -->
  212     <style>
  213       .sheet thead th{ background:#bfbfbf; text-align:center; font-weight:700; padding:6px; }
  214       .sheet .label-cell{ padding:8px; font-size:12px; }
  215       .cell-input{ width:100%; border:0; padding:8px; font:inherit; background:transparent; outline:none; }
  216     </style>
  217 
  218     <!-- ===================== ESFUERZO FISICO ===================== -->
  219     <div class="bar" style="margin-top:8px;">ESFUERZO FISICO</div>
  220     <table class="sheet">
  221       <colgroup>
  222         <col style="width:12%">
  223         <col style="width:20%">
  224         <col style="width:14%">
  225         <col style="width:14%">
  226         <col style="width:12%">
  227         <col style="width:12%">  <!-- EPP -->
  228         <col style="width:8%">   <!-- Frecuencia -->
  229         <col style="width:8%">   <!-- Peso -->
  230       </colgroup>
  231       <thead>
  232         <tr>
  233           <th>Tipos de esfuerzo</th>
  234           <th>Descripción de Carga</th>
  235           <th>Equipo de apoyo</th>
  236           <th>Duración de carga</th>
  237           <th>Distancia de carga</th>
  238           <th>EPP utilizado</th>
  239           <th>Frecuencia</th>
  240           <th>Peso aproximado</th>
  241         </tr>
  242       </thead>
  243       <tbody>
  244         <tr>
  245           <td class="label-cell">Cargar</td>
  246           <td><input class="cell-input" name="fisico_cargar_desc"></td>
  247           <td><input class="cell-input" name="fisico_cargar_equipo"></td>
  248           <td><input class="cell-input" name="fisico_cargar_duracion"></td>
  249           <td><input class="cell-input" name="fisico_cargar_distancia"></td>
  250           <td><input class="cell-input" name="fisico_cargar_epp"></td>
  251           <td><input class="cell-input" name="fisico_cargar_frecuencia"></td>
  252           <td><input class="cell-input" name="fisico_cargar_peso"></td>
  253         </tr>
  254         <tr>
  255           <td class="label-cell">Halar</td>
  256           <td><input class="cell-input" name="fisico_halar_desc"></td>
  257           <td><input class="cell-input" name="fisico_halar_equipo"></td>
  258           <td><input class="cell-input" name="fisico_halar_duracion"></td>
  259           <td><input class="cell-input" name="fisico_halar_distancia"></td>
  260           <td><input class="cell-input" name="fisico_halar_epp"></td>
  261           <td><input class="cell-input" name="fisico_halar_frecuencia"></td>
  262           <td><input class="cell-input" name="fisico_halar_peso"></td>
  263         </tr>
  264         <tr>
  265           <td class="label-cell">Empujar</td>
  266           <td><input class="cell-input" name="fisico_empujar_desc"></td>
  267           <td><input class="cell-input" name="fisico_empujar_equipo"></td>
  268           <td><input class="cell-input" name="fisico_empujar_duracion"></td>
  269           <td><input class="cell-input" name="fisico_empujar_distancia"></td>
  270           <td><input class="cell-input" name="fisico_empujar_epp"></td>
  271           <td><input class="cell-input" name="fisico_empujar_frecuencia"></td>
  272           <td><input class="cell-input" name="fisico_empujar_peso"></td>
  273         </tr>
  274         <tr>
  275           <td class="label-cell">Sujetar</td>
  276           <td><input class="cell-input" name="fisico_sujetar_desc"></td>
  277           <td><input class="cell-input" name="fisico_sujetar_equipo"></td>
  278           <td><input class="cell-input" name="fisico_sujetar_duracion"></td>
  279           <td><input class="cell-input" name="fisico_sujetar_distancia"></td>
  280           <td><input class="cell-input" name="fisico_sujetar_epp"></td>
  281           <td><input class="cell-input" name="fisico_sujetar_frecuencia"></td>
  282           <td><input class="cell-input" name="fisico_sujetar_peso"></td>
  283         </tr>
  284       </tbody>
  285     </table>
  286 
  287 
  288     <!-- ===================== ESFUERZO VISUAL ===================== -->
  289     <div class="bar" style="margin-top:8px;">ESFUERZO VISUAL</div>
  290     <table class="sheet">
  291       <colgroup>
  292         <col style="width:50%">
  293         <col style="width:50%">
  294       </colgroup>
  295       <thead>
  296         <tr>
  297           <th>Tipo de esfuerzo</th>
  298           <th>Tiempo de exposición</th>
  299         </tr>
  300       </thead>
  301       <tbody>
  302         <tr>
  303           <td><input class="cell-input" name="visual_tipo"></td>
  304           <td><input class="cell-input" name="visual_tiempo"></td>
  305         </tr>
  306       </tbody>
  307     </table>
  308 
  309     <!-- ===================== EXPOSICIÓN A RUIDO ===================== -->
  310     <div class="bar" style="margin-top:8px;">EXPOSICIÓN A RUIDO</div>
  311     <table class="sheet">
  312       <colgroup>
  313         <col style="width:50%">
  314         <col style="width:50%">
  315       </colgroup>
  316       <thead>
  317         <tr>
  318           <th>Descripción de Ruido</th>
  319           <th>Duración de exposición</th>
  320         </tr>
  321       </thead>
  322       <tbody>
  323         <tr>
  324           <td><input class="cell-input" name="ruido_desc"></td>
  325           <td><input class="cell-input" name="ruido_duracion"></td>
  326         </tr>
  327       </tbody>
  328     </table>
  329 
  330     <!-- ===================== EXPOSICIÓN STRESS TÉRMICO ===================== -->
  331     <div class="bar" style="margin-top:8px;">EXPOSICIÓN STRESS TÉRMICO</div>
  332     <table class="sheet">
  333       <colgroup>
  334         <col style="width:50%">
  335         <col style="width:50%">
  336       </colgroup>
  337       <thead>
  338         <tr>
  339           <th>Descripción de Stress térmico</th>
  340           <th>Duración de exposición</th>
  341         </tr>
  342       </thead>
  343       <tbody>
  344         <tr>
  345           <td><input class="cell-input" name="termico_desc"></td>
  346           <td><input class="cell-input" name="termico_duracion"></td>
  347         </tr>
  348       </tbody>
  349     </table>
  350 
  351     <!-- ===== EXPOSICIÓN A QUÍMICOS ===== -->
  352 <div class="bar" style="margin-top:8px;">EXPOSICIÓN A QUÍMICOS</div>
  353 <table class="sheet" id="tabla-quimicos">
  354   <colgroup>
  355     <col style="width:50%">
  356     <col style="width:25%">
  357     <col style="width:25%">
  358     <col style="width:28px">
  359   </colgroup>
  360   <thead>
  361     <tr>
  362       <th>Descripción del químico</th>
  363       <th>Duración de exposición</th>
  364       <th>Frecuencia</th>
  365       <th></th>
  366     </tr>
  367   </thead>
  368   <tbody>
  369     <tr class="row-quimico">
  370     <td>
  371       <!-- visible: nombre; hidden: id_quimico -->
  372       <input class="cell-input quimico-nombre" name="quimicos[0][nombre]" list="quimico-list"
  373             placeholder="Escribe para buscar…" autocomplete="off">
  374       <input type="hidden" class="quimico-id" name="quimicos[0][id_quimico]">
  375       <datalist id="quimico-list">
  376         @foreach ($quimicos as $q)
  377           <option data-id="{{ $q->id_quimico }}" value="{{ $q->nombre_comercial }}"></option>
  378         @endforeach
  379       </datalist>
  380     </td>
  381     <td><input class="cell-input" name="quimicos[0][duracion]"></td>
  382     <td><input class="cell-input" name="quimicos[0][frecuencia]"></td>
  383     <td style="text-align:center; vertical-align:middle;">
  384       <button type="button" class="icon-btn add" aria-label="Añadir químico">+</button>
  385     </td>
  386   </tr>
  387   </tbody>
  388 </table>
  389 
  390 <style>
  391   /* Botones de + / × dentro de la celda angosta */
  392   .icon-btn{
  393     width:100%; height:100%;
  394     min-height:34px;
  395     display:flex; align-items:center; justify-content:center;
  396     font-size:20px; line-height:1; background:transparent; border:0; cursor:pointer;
  397   }
  398   .icon-btn:focus{ outline:2px solid #666; outline-offset:-2px; }
  399 </style>
  400 
  401 <script>
  402 (() => {
  403   const tabla = document.getElementById('tabla-quimicos');
  404   const tbody = tabla.querySelector('tbody');
  405 
  406   function idFromDatalist(input) {
  407     const listId = input.getAttribute('list');
  408     const dl = document.getElementById(listId);
  409     const val = (input.value || '').trim().toLowerCase();
  410     if (!dl) return '';
  411     const opt = Array.from(dl.options || []).find(o =>
  412       (o.value || '').trim().toLowerCase() === val
  413     );
  414     return opt ? (opt.getAttribute('data-id') || '') : '';
  415   }
  416 
  417   function wireRow(tr) {
  418     const nombre = tr.querySelector('input.quimico-nombre');
  419     const hidden = tr.querySelector('input.quimico-id');
  420     if (!nombre || !hidden) return;
  421     const upd = () => { hidden.value = idFromDatalist(nombre) };
  422     nombre.addEventListener('input', upd);
  423     nombre.addEventListener('change', upd);
  424     upd(); // inicializar
  425   }
  426 
  427   function renumerar() {
  428     [...tbody.querySelectorAll('tr')].forEach((tr, i) => {
  429       tr.querySelectorAll('select, input').forEach(el => {
  430         if (el.name) el.name = el.name.replace(/\[\d+\]/, `[${i}]`);
  431       });
  432     });
  433   }
  434 
  435   function actualizarBotones() {
  436     const filas = tbody.querySelectorAll('tr');
  437     filas.forEach((tr, i) => {
  438       const btn = tr.querySelector('.icon-btn');
  439       if (i === filas.length - 1) {
  440         btn.textContent = '+';
  441         btn.classList.add('add');
  442         btn.classList.remove('remove');
  443         btn.setAttribute('aria-label','Añadir químico');
  444       } else {
  445         btn.textContent = '×';
  446         btn.classList.remove('add');
  447         btn.classList.add('remove');
  448         btn.setAttribute('aria-label','Eliminar fila');
  449       }
  450     });
  451   }
  452 
  453   tabla.addEventListener('click', (e) => {
  454     const btn = e.target.closest('.icon-btn');
  455     if (!btn) return;
  456     const fila = btn.closest('tr');
  457 
  458     if (btn.classList.contains('add')) {
  459       const clon = fila.cloneNode(true);
  460       clon.querySelectorAll('input').forEach(i => i.value = '');
  461       tbody.appendChild(clon);
  462       renumerar();
  463       actualizarBotones();
  464       wireRow(clon); // <-- importante
  465     } else if (btn.classList.contains('remove')) {
  466       fila.remove();
  467       renumerar();
  468       actualizarBotones();
  469     }
  470   });
  471 
  472   // inicializar primera fila
  473   wireRow(tbody.querySelector('tr'));
  474   actualizarBotones();
  475 })();
  476 </script>
  477 
  478 
  479 <!-- ===== CONDICIONES DE INSTALACIONES ===== -->
  480 <div class="bar" style="margin-top:8px;">CONDICIONES DE INSTALACIONES</div>
  481 <table class="sheet">
  482   <colgroup>
  483     <col style="width:40%">
  484     <col style="width:10%">
  485     <col style="width:10%">
  486     <col style="width:10%">
  487     <col style="width:30%">
  488   </colgroup>
  489   <thead>
  490     <tr>
  491       <th>Descripción del elemento</th>
  492       <th>Adecuado</th>
  493       <th>No adecuado</th>
  494       <th>N/A</th>
  495       <th>Observaciones</th>
  496     </tr>
  497   </thead>
  498   <tbody>
  499     <!-- Fila 1 -->
  500     <tr>
  501       <td class="label-cell">Paredes, muros, losas y trabes</td>
  502       <td class="center"><input type="radio" name="instalaciones[0][estado]" value="A"></td>
  503       <td class="center"><input type="radio" name="instalaciones[0][estado]" value="NA"></td>
  504       <td class="center"><input type="radio" name="instalaciones[0][estado]" value="N/A"></td>
  505       <td><input class="cell-input obs-input" name="instalaciones[0][obs]"></td>
  506     </tr>
  507     <!-- Fila 2 -->
  508     <tr>
  509       <td class="label-cell">Pisos</td>
  510       <td class="center"><input type="radio" name="instalaciones[1][estado]" value="A"></td>
  511       <td class="center"><input type="radio" name="instalaciones[1][estado]" value="NA"></td>
  512       <td class="center"><input type="radio" name="instalaciones[1][estado]" value="N/A"></td>
  513       <td><input class="cell-input obs-input" name="instalaciones[1][obs]"></td>
  514     </tr>
  515     <!-- Fila 3 -->
  516     <tr>
  517       <td class="label-cell">Techos</td>
  518       <td class="center"><input type="radio" name="instalaciones[2][estado]" value="A"></td>
  519       <td class="center"><input type="radio" name="instalaciones[2][estado]" value="NA"></td>
  520       <td class="center"><input type="radio" name="instalaciones[2][estado]" value="N/A"></td>
  521       <td><input class="cell-input obs-input" name="instalaciones[2][obs]"></td>
  522     </tr>
  523     <!-- Fila 4 -->
  524     <tr>
  525       <td class="label-cell">Puertas y Ventanas</td>
  526       <td class="center"><input type="radio" name="instalaciones[3][estado]" value="A"></td>
  527       <td class="center"><input type="radio" name="instalaciones[3][estado]" value="NA"></td>
  528       <td class="center"><input type="radio" name="instalaciones[3][estado]" value="N/A"></td>
  529       <td><input class="cell-input obs-input" name="instalaciones[3][obs]"></td>
  530     </tr>
  531     <!-- Fila 5 -->
  532     <tr>
  533       <td class="label-cell">Escaleras y rampas</td>
  534       <td class="center"><input type="radio" name="instalaciones[4][estado]" value="A"></td>
  535       <td class="center"><input type="radio" name="instalaciones[4][estado]" value="NA"></td>
  536       <td class="center"><input type="radio" name="instalaciones[4][estado]" value="N/A"></td>
  537       <td><input class="cell-input obs-input" name="instalaciones[4][obs]"></td>
  538     </tr>
  539     <!-- Fila 6 -->
  540     <tr>
  541       <td class="label-cell">Anaqueles y estantería</td>
  542       <td class="center"><input type="radio" name="instalaciones[5][estado]" value="A"></td>
  543       <td class="center"><input type="radio" name="instalaciones[5][estado]" value="NA"></td>
  544       <td class="center"><input type="radio" name="instalaciones[5][estado]" value="N/A"></td>
  545       <td><input class="cell-input obs-input" name="instalaciones[5][obs]"></td>
  546     </tr>
  547   </tbody>
  548 </table>
  549 
  550 <!-- ===== MAQUINARIA, EQUIPO Y HERRAMIENTAS ===== -->
  551 <div class="bar" style="margin-top:8px;">MAQUINARIA, EQUIPO Y HERRAMIENTAS</div>
  552 <table class="sheet">
  553   <colgroup>
  554     <col style="width:40%">
  555     <col style="width:10%">
  556     <col style="width:10%">
  557     <col style="width:10%">
  558     <col style="width:30%">
  559   </colgroup>
  560   <thead>
  561     <tr>
  562       <th>Descripción del elemento</th>
  563       <th>Adecuado</th>
  564       <th>No adecuado</th>
  565       <th>N/A</th>
  566       <th>Observaciones</th>
  567     </tr>
  568   </thead>
  569   <tbody>
  570     <tr>
  571       <td class="label-cell">Estado de Maquinaria y Equipo</td>
  572       <td class="center"><input type="radio" name="maq[0][estado]" value="A"></td>
  573       <td class="center"><input type="radio" name="maq[0][estado]" value="NA"></td>
  574       <td class="center"><input type="radio" name="maq[0][estado]" value="N/A"></td>
  575       <td><input class="cell-input obs-input" name="maq[0][obs]"></td>
  576     </tr>
  577     <tr>
  578       <td class="label-cell">Se ejecuta mantenimiento preventivo</td>
  579       <td class="center"><input type="radio" name="maq[1][estado]" value="A"></td>
  580       <td class="center"><input type="radio" name="maq[1][estado]" value="NA"></td>
  581       <td class="center"><input type="radio" name="maq[1][estado]" value="N/A"></td>
  582       <td><input class="cell-input obs-input" name="maq[1][obs]"></td>
  583     </tr>
  584     <tr>
  585       <td class="label-cell">Se ejecuta mantenimiento correctivo</td>
  586       <td class="center"><input type="radio" name="maq[2][estado]" value="A"></td>
  587       <td class="center"><input type="radio" name="maq[2][estado]" value="NA"></td>
  588       <td class="center"><input type="radio" name="maq[2][estado]" value="N/A"></td>
  589       <td><input class="cell-input obs-input" name="maq[2][obs]"></td>
  590     </tr>
  591     <tr>
  592       <td class="label-cell">Estado resguardos y guardas</td>
  593       <td class="center"><input type="radio" name="maq[3][estado]" value="A"></td>
  594       <td class="center"><input type="radio" name="maq[3][estado]" value="NA"></td>
  595       <td class="center"><input type="radio" name="maq[3][estado]" value="N/A"></td>
  596       <td><input class="cell-input obs-input" name="maq[3][obs]"></td>
  597     </tr>
  598     <tr>
  599       <td class="label-cell">Estado de conexiones eléctricas de maquinaria</td>
  600       <td class="center"><input type="radio" name="maq[4][estado]" value="A"></td>
  601       <td class="center"><input type="radio" name="maq[4][estado]" value="NA"></td>
  602       <td class="center"><input type="radio" name="maq[4][estado]" value="N/A"></td>
  603       <td><input class="cell-input obs-input" name="maq[4][obs]"></td>
  604     </tr>
  605     <tr>
  606       <td class="label-cell">Se realizan inspecciones de Maquinaria y Equipos</td>
  607       <td class="center"><input type="radio" name="maq[5][estado]" value="A"></td>
  608       <td class="center"><input type="radio" name="maq[5][estado]" value="NA"></td>
  609       <td class="center"><input type="radio" name="maq[5][estado]" value="N/A"></td>
  610       <td><input class="cell-input obs-input" name="maq[5][obs]"></td>
  611     </tr>
  612     <tr>
  613       <td class="label-cell">Estado de paros de emergencia</td>
  614       <td class="center"><input type="radio" name="maq[6][estado]" value="A"></td>
  615       <td class="center"><input type="radio" name="maq[6][estado]" value="NA"></td>
  616       <td class="center"><input type="radio" name="maq[6][estado]" value="N/A"></td>
  617       <td><input class="cell-input obs-input" name="maq[6][obs]"></td>
  618     </tr>
  619     <tr>
  620       <td class="label-cell">Tiene el entrenamiento correspondiente para uso de maquinaria y equipo</td>
  621       <td class="center"><input type="radio" name="maq[7][estado]" value="A"></td>
  622       <td class="center"><input type="radio" name="maq[7][estado]" value="NA"></td>
  623       <td class="center"><input type="radio" name="maq[7][estado]" value="N/A"></td>
  624       <td><input class="cell-input obs-input" name="maq[7][obs]"></td>
  625     </tr>
  626     <tr>
  627       <td class="label-cell">Utiliza el EPP correspondiente, especifique cuál</td>
  628       <td class="center"><input type="radio" name="maq[8][estado]" value="A"></td>
  629       <td class="center"><input type="radio" name="maq[8][estado]" value="NA"></td>
  630       <td class="center"><input type="radio" name="maq[8][estado]" value="N/A"></td>
  631       <td><input class="cell-input obs-input" name="maq[8][obs]"></td>
  632     </tr>
  633     <tr>
  634       <td class="label-cell">Estado de herramientas</td>
  635       <td class="center"><input type="radio" name="maq[9][estado]" value="A"></td>
  636       <td class="center"><input type="radio" name="maq[9][estado]" value="NA"></td>
  637       <td class="center"><input type="radio" name="maq[9][estado]" value="N/A"></td>
  638       <td><input class="cell-input obs-input" name="maq[9][obs]"></td>
  639     </tr>
  640     <tr>
  641       <td class="label-cell">Se realizan inspecciones de Herramientas</td>
  642       <td class="center"><input type="radio" name="maq[10][estado]" value="A"></td>
  643       <td class="center"><input type="radio" name="maq[10][estado]" value="NA"></td>
  644       <td class="center"><input type="radio" name="maq[10][estado]" value="N/A"></td>
  645       <td><input class="cell-input obs-input" name="maq[10][obs]"></td>
  646     </tr>
  647     <tr>
  648       <td class="label-cell">Almacenamiento Correcto de Herramientas</td>
  649       <td class="center"><input type="radio" name="maq[11][estado]" value="A"></td>
  650       <td class="center"><input type="radio" name="maq[11][estado]" value="NA"></td>
  651       <td class="center"><input type="radio" name="maq[11][estado]" value="N/A"></td>
  652       <td><input class="cell-input obs-input" name="maq[11][obs]"></td>
  653     </tr>
  654   </tbody>
  655 </table>
  656 
  657 <!-- ===== EQUIPOS Y SERVICIOS DE EMERGENCIA ===== -->
  658 <div class="bar" style="margin-top:8px;">EQUIPOS Y SERVICIOS DE EMERGENCIA</div>
  659 <table class="sheet">
  660   <colgroup>
  661     <col style="width:40%">
  662     <col style="width:10%">
  663     <col style="width:10%">
  664     <col style="width:10%">
  665     <col style="width:30%">
  666   </colgroup>
  667   <thead>
  668     <tr>
  669       <th>Descripción de elemento</th>
  670       <th>Adecuado</th>
  671       <th>No adecuado</th>
  672       <th>N/A</th>
  673       <th>Observaciones</th>
  674     </tr>
  675   </thead>
  676   <tbody>
  677     <tr>
  678       <td class="label-cell">Señalización rutas de evacuación y salidas de emergencia y punto reunión</td>
  679       <td class="center"><input type="radio" name="emer[0][estado]" value="A"></td>
  680       <td class="center"><input type="radio" name="emer[0][estado]" value="NA"></td>
  681       <td class="center"><input type="radio" name="emer[0][estado]" value="N/A"></td>
  682       <td><input class="cell-input obs-input" name="emer[0][obs]"></td>
  683     </tr>
  684     <tr>
  685       <td class="label-cell">Ubicación de Extintores o mangueras de incendios</td>
  686       <td class="center"><input type="radio" name="emer[1][estado]" value="A"></td>
  687       <td class="center"><input type="radio" name="emer[1][estado]" value="NA"></td>
  688       <td class="center"><input type="radio" name="emer[1][estado]" value="N/A"></td>
  689       <td><input class="cell-input obs-input" name="emer[1][obs]"></td>
  690     </tr>
  691     <tr>
  692       <td class="label-cell">Ubicación de Camillas y elementos de primeros auxilios</td>
  693       <td class="center"><input type="radio" name="emer[2][estado]" value="A"></td>
  694       <td class="center"><input type="radio" name="emer[2][estado]" value="NA"></td>
  695       <td class="center"><input type="radio" name="emer[2][estado]" value="N/A"></td>
  696       <td><input class="cell-input obs-input" name="emer[2][obs]"></td>
  697     </tr>
  698     <tr>
  699       <td class="label-cell">Ubicación de Botiquín</td>
  700       <td class="center"><input type="radio" name="emer[3][estado]" value="A"></td>
  701       <td class="center"><input type="radio" name="emer[3][estado]" value="NA"></td>
  702       <td class="center"><input type="radio" name="emer[3][estado]" value="N/A"></td>
  703       <td><input class="cell-input obs-input" name="emer[3][obs]"></td>
  704     </tr>
  705     <tr>
  706       <td class="label-cell">Realización de Simulacros</td>
  707       <td class="center"><input type="radio" name="emer[4][estado]" value="A"></td>
  708       <td class="center"><input type="radio" name="emer[4][estado]" value="NA"></td>
  709       <td class="center"><input type="radio" name="emer[4][estado]" value="N/A"></td>
  710       <td><input class="cell-input obs-input" name="emer[4][obs]"></td>
  711     </tr>
  712     <tr>
  713       <td class="label-cell">Socialización Plan de evacuación</td>
  714       <td class="center"><input type="radio" name="emer[5][estado]" value="A"></td>
  715       <td class="center"><input type="radio" name="emer[5][estado]" value="NA"></td>
  716       <td class="center"><input type="radio" name="emer[5][estado]" value="N/A"></td>
  717       <td><input class="cell-input obs-input" name="emer[5][obs]"></td>
  718     </tr>
  719     <tr>
  720       <td class="label-cell">Capacitación sobre actuación en caso de emergencia y uso de extintor.</td>
  721       <td class="center"><input type="radio" name="emer[6][estado]" value="A"></td>
  722       <td class="center"><input type="radio" name="emer[6][estado]" value="NA"></td>
  723       <td class="center"><input type="radio" name="emer[6][estado]" value="N/A"></td>
  724       <td><input class="cell-input obs-input" name="emer[6][obs]"></td>
  725     </tr>
  726     <tr>
  727       <td class="label-cell">Ubicación de alarmas aviso emergencia</td>
  728       <td class="center"><input type="radio" name="emer[7][estado]" value="A"></td>
  729       <td class="center"><input type="radio" name="emer[7][estado]" value="NA"></td>
  730       <td class="center"><input type="radio" name="emer[7][estado]" value="N/A"></td>
  731       <td><input class="cell-input obs-input" name="emer[7][obs]"></td>
  732     </tr>
  733     <tr>
  734       <td class="label-cell">Ubicación de alarmas de humo</td>
  735       <td class="center"><input type="radio" name="emer[8][estado]" value="A"></td>
  736       <td class="center"><input type="radio" name="emer[8][estado]" value="NA"></td>
  737       <td class="center"><input type="radio" name="emer[8][estado]" value="N/A"></td>
  738       <td><input class="cell-input obs-input" name="emer[8][obs]"></td>
  739     </tr>
  740     <tr>
  741       <td class="label-cell">Ubicación de lámparas de emergencia</td>
  742       <td class="center"><input type="radio" name="emer[9][estado]" value="A"></td>
  743       <td class="center"><input type="radio" name="emer[9][estado]" value="NA"></td>
  744       <td class="center"><input type="radio" name="emer[9][estado]" value="N/A"></td>
  745       <td><input class="cell-input obs-input" name="emer[9][obs]"></td>
  746     </tr>
  747   </tbody>
  748 </table>
  749 
  750 <!-- ===== RIESGO DE FUEGO O EXPLOSIÓN ===== -->
  751 <div class="bar" style="margin-top:8px;">RIESGO DE FUEGO O EXPLOSIÓN</div>
  752 <table class="sheet">
  753   <colgroup>
  754     <col style="width:33.33%">
  755     <col style="width:33.33%">
  756     <col style="width:33.34%">
  757   </colgroup>
  758   <tbody>
  759     <tr>
  760       <td>
  761         <label class="checkcell">
  762           <select name="riesgo_fuego[inflamables_area]">
  763             <option value="" selected>—</option>
  764             <option value="si">Sí</option>
  765             <option value="no">No</option>
  766             <option value="na">N/A</option>
  767           </select>
  768           <span>Hay sustancias inflamables o combustible o material explosivo en su área de trabajo</span>
  769         </label>
  770       </td>
  771       <td>
  772         <label class="checkcell">
  773           <select name="riesgo_fuego[ventilacion_extraccion]">
  774             <option value="" selected>—</option>
  775             <option value="si">Sí</option>
  776             <option value="no">No</option>
  777             <option value="na">N/A</option>
  778           </select>
  779           <span>Hay ventilación natural suficiente o sistema de extracción</span>
  780         </label>
  781       </td>
  782       <td>
  783         <label class="checkcell">
  784           <select name="riesgo_fuego[limpieza_regulares]">
  785             <option value="" selected>—</option>
  786             <option value="si">Sí</option>
  787             <option value="no">No</option>
  788             <option value="na">N/A</option>
  789           </select>
  790           <span>Se realiza limpiezas regulares en el área de trabajo</span>
  791         </label>
  792       </td>
  793     </tr>
  794 
  795     <tr>
  796       <td>
  797         <label class="checkcell">
  798           <select name="riesgo_fuego[senalizacion_riesgo]">
  799             <option value="" selected>—</option>
  800             <option value="si">Sí</option>
  801             <option value="no">No</option>
  802             <option value="na">N/A</option>
  803           </select>
  804           <span>Está la debida señalización de riesgo inflamable o de explosión si se requiere</span>
  805         </label>
  806       </td>
  807       <td>
  808         <label class="checkcell">
  809           <select name="riesgo_fuego[focos_ignicion]">
  810             <option value="" selected>—</option>
  811             <option value="si">Sí</option>
  812             <option value="no">No</option>
  813             <option value="na">N/A</option>
  814           </select>
  815           <span>Hay fuentes de calor o focos de ignición cercanos</span>
  816         </label>
  817       </td>
  818       <td>
  819         <label class="checkcell">
  820           <select name="riesgo_fuego[riesgo_electrico_friccion]">
  821             <option value="" selected>—</option>
  822             <option value="si">Sí</option>
  823             <option value="no">No</option>
  824             <option value="na">N/A</option>
  825           </select>
  826           <span>Hay maquinaria o equipo que represente un riesgo eléctrico o de fricción</span>
  827         </label>
  828       </td>
  829     </tr>
  830 
  831     <tr>
  832       <td>
  833         <label class="checkcell">
  834           <select name="riesgo_fuego[trasiego_combustibles]">
  835             <option value="" selected>—</option>
  836             <option value="si">Sí</option>
  837             <option value="no">No</option>
  838             <option value="na">N/A</option>
  839           </select>
  840           <span>Realizan trasiego de líquidos combustibles o inflamables</span>
  841         </label>
  842       </td>
  843       <td>
  844         <label class="checkcell">
  845           <select name="riesgo_fuego[cilindros_alta_presion]">
  846             <option value="" selected>—</option>
  847             <option value="si">Sí</option>
  848             <option value="no">No</option>
  849             <option value="na">N/A</option>
  850           </select>
  851           <span>Trabaja con cilindros de alta presión, están ubicados en su estructura y con cadena seguridad</span>
  852         </label>
  853       </td>
  854       <td>
  855         <label class="checkcell">
  856           <select name="riesgo_fuego[derrames_combustibles]">
  857             <option value="" selected>—</option>
  858             <option value="si">Sí</option>
  859             <option value="no">No</option>
  860             <option value="na">N/A</option>
  861           </select>
  862           <span>Hay derrames de sustancia combustibles o inflamables</span>
  863         </label>
  864       </td>
  865     </tr>
  866   </tbody>
  867 </table>
  868 
  869 <!-- estilos de apoyo para las celdas con checkbox -->
  870 <style>
  871   .checkcell{ display:flex; align-items:flex-start; gap:8px; padding:8px; }
  872   .checkcell input[type="checkbox"]{ transform: scale(1.15); margin-top:2px; }
  873 </style>
  874 
  875 <!-- ===== POSICIONES O MOVIMIENTOS DE TRABAJO ERGONÓMICO ===== -->
  876 <div class="bar" style="margin-top:8px;">POSICIONES O MOVIMIENTOS DE TRABAJO ERGONÓMICO</div>
  877 <table class="sheet">
  878   <colgroup>
  879     <col style="width:50%">
  880     <col style="width:7%">
  881     <col style="width:7%">
  882     <col style="width:7%">
  883     <col style="width:29%">
  884   </colgroup>
  885   <thead>
  886     <tr>
  887       <th>Descripción de elemento</th>
  888       <th>SI</th>
  889       <th>NO</th>
  890       <th>N/A</th>
  891       <th>Observaciones</th>
  892     </tr>
  893   </thead>
  894   <tbody>
  895     <tr>
  896       <td class="label-cell">Realiza movimientos repetitivos, ¿con qué frecuencia y duración?</td>
  897       <td class="center"><input type="radio" name="ergo[0][resp]" value="SI"></td>
  898       <td class="center"><input type="radio" name="ergo[0][resp]" value="NO"></td>
  899       <td class="center"><input type="radio" name="ergo[0][resp]" value="NA"></td>
  900       <td><input class="cell-input" name="ergo[0][obs]"></td>
  901     </tr>
  902     <tr>
  903       <td class="label-cell">Realizo posturas forzadas, ¿durante cuánto tiempo?</td>
  904       <td class="center"><input type="radio" name="ergo[1][resp]" value="SI"></td>
  905       <td class="center"><input type="radio" name="ergo[1][resp]" value="NO"></td>
  906       <td class="center"><input type="radio" name="ergo[1][resp]" value="NA"></td>
  907       <td><input class="cell-input" name="ergo[1][obs]"></td>
  908     </tr>
  909     <tr>
  910       <td class="label-cell">Tengo suficiente espacio para realizar la tarea</td>
  911       <td class="center"><input type="radio" name="ergo[2][resp]" value="SI"></td>
  912       <td class="center"><input type="radio" name="ergo[2][resp]" value="NO"></td>
  913       <td class="center"><input type="radio" name="ergo[2][resp]" value="NA"></td>
  914       <td><input class="cell-input" name="ergo[2][obs]"></td>
  915     </tr>
  916     <tr>
  917       <td class="label-cell">Realizo elevación de brazos, ¿a qué grados?</td>
  918       <td class="center"><input type="radio" name="ergo[3][resp]" value="SI"></td>
  919       <td class="center"><input type="radio" name="ergo[3][resp]" value="NO"></td>
  920       <td class="center"><input type="radio" name="ergo[3][resp]" value="NA"></td>
  921       <td><input class="cell-input" name="ergo[3][obs]"></td>
  922     </tr>
  923     <tr>
  924       <td class="label-cell">Realiza movimiento o giros de la muñeca</td>
  925       <td class="center"><input type="radio" name="ergo[4][resp]" value="SI"></td>
  926       <td class="center"><input type="radio" name="ergo[4][resp]" value="NO"></td>
  927       <td class="center"><input type="radio" name="ergo[4][resp]" value="NA"></td>
  928       <td><input class="cell-input" name="ergo[4][obs]"></td>
  929     </tr>
  930     <tr>
  931       <td class="label-cell">Realizo inclinación de espalda o cuello, ¿a qué grados?</td>
  932       <td class="center"><input type="radio" name="ergo[5][resp]" value="SI"></td>
  933       <td class="center"><input type="radio" name="ergo[5][resp]" value="NO"></td>
  934       <td class="center"><input type="radio" name="ergo[5][resp]" value="NA"></td>
  935       <td><input class="cell-input" name="ergo[5][obs]"></td>
  936     </tr>
  937     <tr>
  938       <td class="label-cell">Manipula alguna herramienta o utensilio constantemente</td>
  939       <td class="center"><input type="radio" name="ergo[6][resp]" value="SI"></td>
  940       <td class="center"><input type="radio" name="ergo[6][resp]" value="NO"></td>
  941       <td class="center"><input type="radio" name="ergo[6][resp]" value="NA"></td>
  942       <td><input class="cell-input" name="ergo[6][obs]"></td>
  943     </tr>
  944     <tr>
  945       <td class="label-cell">Manipula herramienta que genere vibración, ¿cuál y por cuánto tiempo?</td>
  946       <td class="center"><input type="radio" name="ergo[7][resp]" value="SI"></td>
  947       <td class="center"><input type="radio" name="ergo[7][resp]" value="NO"></td>
  948       <td class="center"><input type="radio" name="ergo[7][resp]" value="NA"></td>
  949       <td><input class="cell-input" name="ergo[7][obs]"></td>
  950     </tr>
  951   </tbody>
  952 </table>
  953 
  954 <!-- ===== POSTURAS (matriz de checkboxes) ===== -->
  955 <div class="bar" style="margin-top:8px;">POSTURAS</div>
  956 <table class="sheet">
  957   <colgroup>
  958     <col style="width:16.66%">
  959     <col style="width:16.66%">
  960     <col style="width:16.66%">
  961     <col style="width:16.66%">
  962     <col style="width:16.66%">
  963     <col style="width:16.70%">
  964   </colgroup>
  965   <tbody>
  966     <tr>
  967       <td class="center">
  968         <label class="checkcell">
  969           <input type="checkbox" name="posturas[]" value="agachado"><span>Agachado</span>
  970         </label>
  971       </td>
  972       <td class="center">
  973         <label class="checkcell">
  974           <input type="checkbox" name="posturas[]" value="de_rodillas"><span>De rodillas</span>
  975         </label>
  976       </td>
  977       <td class="center">
  978         <label class="checkcell">
  979           <input type="checkbox" name="posturas[]" value="volteado"><span>Volteado</span>
  980         </label>
  981       </td>
  982       <td class="center">
  983         <label class="checkcell">
  984           <input type="checkbox" name="posturas[]" value="parado"><span>Parado</span>
  985         </label>
  986       </td>
  987       <td class="center">
  988         <label class="checkcell">
  989           <input type="checkbox" name="posturas[]" value="sentado"><span>Sentado</span>
  990         </label>
  991       </td>
  992       <td class="center">
  993         <label class="checkcell">
  994           <input type="checkbox" name="posturas[]" value="arrastrandose"><span>Arrastrándose</span>
  995         </label>
  996       </td>
  997     </tr>
  998     <tr>
  999       <td class="center">
 1000         <label class="checkcell">
 1001           <input type="checkbox" name="posturas[]" value="subiendo"><span>Subiendo</span>
 1002         </label>
 1003       </td>
 1004       <td class="center">
 1005         <label class="checkcell">
 1006           <input type="checkbox" name="posturas[]" value="balanceandose"><span>Balanceándose</span>
 1007         </label>
 1008       </td>
 1009       <td class="center">
 1010         <label class="checkcell">
 1011           <input type="checkbox" name="posturas[]" value="corriendo"><span>Corriendo</span>
 1012         </label>
 1013       </td>
 1014       <td class="center">
 1015         <label class="checkcell">
 1016           <input type="checkbox" name="posturas[]" value="empujando"><span>Empujando</span>
 1017         </label>
 1018       </td>
 1019       <td class="center">
 1020         <label class="checkcell">
 1021           <input type="checkbox" name="posturas[]" value="halando"><span>Halando</span>
 1022         </label>
 1023       </td>
 1024       <td class="center">
 1025         <label class="checkcell">
 1026           <input type="checkbox" name="posturas[]" value="girando"><span>Girando</span>
 1027         </label>
 1028       </td>
 1029     </tr>
 1030   </tbody>
 1031 </table>
 1032 
 1033 <!-- ===== RIESGO CONDICIONES DE TRABAJO ===== -->
 1034 <div class="bar" style="margin-top:8px;">RIESGO CONDICIONES DE TRABAJO</div>
 1035 
 1036 <!-- Subtítulo centrado como en el formato -->
 1037 <table class="sheet">
 1038   <thead>
 1039     <tr>
 1040       <th colspan="4" class="subhead">TRABAJO EN ALTURAS</th>
 1041     </tr>
 1042   </thead>
 1043   <tbody>
 1044     <tr>
 1045       <td class="label-cell" style="width:25%;">Altura</td>
 1046       <td style="width:25%;"><input class="cell-input" name="alturas[altura]"></td>
 1047       <td class="label-cell" style="width:25%;">Cuenta con medios de anclaje y acceso seguro</td>
 1048       <td style="width:25%;"><input class="cell-input" name="alturas[anclaje_seguro]"></td>
 1049     </tr>
 1050     <tr>
 1051       <td class="label-cell">Se da Aviso del trabajo en altura</td>
 1052       <td><input class="cell-input" name="alturas[aviso_trabajo_altura]"></td>
 1053       <td class="label-cell">Firma hoja de trabajo seguro</td>
 1054       <td><input class="cell-input" name="alturas[firma_trabajo_seguro]"></td>
 1055     </tr>
 1056   </tbody>
 1057 </table>
 1058 
 1059 <!-- estilos de apoyo (si aún no estaban) -->
 1060 <style>
 1061   td.center input[type="radio"]{ transform: scale(1.2); }
 1062   .checkcell{ display:flex; align-items:center; gap:6px; padding:6px; }
 1063   .checkcell input[type="checkbox"]{ transform: scale(1.1); }
 1064   .subhead{ background:transparent !important; font-weight:700; text-transform:uppercase; text-align:center; }
 1065 </style>
 1066 
 1067 <!-- ===== TRABAJO CON ELECTRICIDAD / RIESGO ELÉCTRICO ===== -->
 1068 <div class="bar" style="margin-top:8px;">TRABAJO CON ELECTRICIDAD / RIESGO ELÉCTRICO</div>
 1069 <table class="sheet">
 1070   <colgroup>
 1071     <col style="width:16.66%"><col style="width:16.66%">
 1072     <col style="width:16.66%"><col style="width:16.66%">
 1073     <col style="width:16.66%"><col style="width:16.70%">
 1074   </colgroup>
 1075   <tbody>
 1076   <tr>
 1077     <td class="label-cell">Señalización y delimitación</td>
 1078     <td>
 1079       <select class="cell-input" name="elec_senalizacion">
 1080         <option value="" selected>—</option>
 1081         <option value="si">Sí</option>
 1082         <option value="no">No</option>
 1083         <option value="na">N/A</option>
 1084       </select>
 1085     </td>
 1086 
 1087     <td class="label-cell">Capacitación o certificación recibida</td>
 1088     <td>
 1089       <select class="cell-input" name="elec_capacitacion">
 1090         <option value="" selected>—</option>
 1091         <option value="si">Sí</option>
 1092         <option value="no">No</option>
 1093         <option value="na">N/A</option>
 1094       </select>
 1095     </td>
 1096 
 1097     <td class="label-cell">Hay alta tensión en su área de trabajo y está señalada y con acceso restringido</td>
 1098     <td>
 1099       <select class="cell-input" name="elec_alta_tension">
 1100         <option value="" selected>—</option>
 1101         <option value="si">Sí</option>
 1102         <option value="no">No</option>
 1103         <option value="na">N/A</option>
 1104       </select>
 1105     </td>
 1106   </tr>
 1107 
 1108   <tr>
 1109     <td class="label-cell">Firma de Hoja de Trabajo Seguro</td>
 1110     <td>
 1111       <select class="cell-input" name="elec_hoja_trabajo_seguro">
 1112         <option value="" selected>—</option>
 1113         <option value="si">Sí</option>
 1114         <option value="no">No</option>
 1115         <option value="na">N/A</option>
 1116       </select>
 1117     </td>
 1118 
 1119     <td class="label-cell">Hay zonas de electricidad estática</td>
 1120     <td>
 1121       <select class="cell-input" name="elec_estatica">
 1122         <option value="" selected>—</option>
 1123         <option value="si">Sí</option>
 1124         <option value="no">No</option>
 1125         <option value="na">N/A</option>
 1126       </select>
 1127     </td>
 1128 
 1129     <td class="label-cell">Verificación de ausencia de tensión antes de trabajar</td>
 1130     <td>
 1131       <select class="cell-input" name="elec_ausencia_tension">
 1132         <option value="" selected>—</option>
 1133         <option value="si">Sí</option>
 1134         <option value="no">No</option>
 1135         <option value="na">N/A</option>
 1136       </select>
 1137     </td>
 1138   </tr>
 1139 
 1140   <tr>
 1141     <td class="label-cell" colspan="1">Sistema de bloqueo con tarjeta y candado</td>
 1142     <td colspan="2">
 1143       <select class="cell-input" name="elec_bloqueo">
 1144         <option value="" selected>—</option>
 1145         <option value="si">Sí</option>
 1146         <option value="no">No</option>
 1147         <option value="na">N/A</option>
 1148       </select>
 1149     </td>
 1150 
 1151     <td class="label-cell" colspan="1">Se da aviso de la realización trabajo eléctrico</td>
 1152     <td colspan="2">
 1153       <select class="cell-input" name="elec_aviso">
 1154         <option value="" selected>—</option>
 1155         <option value="si">Sí</option>
 1156         <option value="no">No</option>
 1157         <option value="na">N/A</option>
 1158       </select>
 1159     </td>
 1160   </tr>
 1161 
 1162    <!-- Instrucciones -->
 1163 <tr>
 1164   <td class="instrucciones" colspan="6">
 1165     Instrucciones: Responder sí o no en la casilla que le corresponde y cualquier observación colocarla en el espacio de observaciones
 1166   </td>
 1167 </tr>
 1168 
 1169 <!-- Matriz de verificación (3 celdas por fila, 100% del ancho) -->
 1170 <tr>
 1171   <td colspan="2">
 1172     <label class="checkcell">
 1173       <input type="checkbox" name="elec_chk[]" value="cables_ordenados">
 1174       <span>Los cables se encuentran ordenados sin obstaculizar el paso.</span>
 1175     </label>
 1176   </td>
 1177   <td colspan="2">
 1178     <label class="checkcell">
 1179       <input type="checkbox" name="elec_chk[]" value="toma_lejos_humedad">
 1180       <span>Las tomacorriente e interruptores están alejadas de fuentes de humedad o salpicadura de agua.</span>
 1181     </label>
 1182   </td>
 1183   <td colspan="2">
 1184     <label class="checkcell">
 1185       <input type="checkbox" name="elec_chk[]" value="cajas_rotuladas_cerradas">
 1186       <span>Las cajas e interruptores se encuentran rotulados y cerrados</span>
 1187     </label>
 1188   </td>
 1189 </tr>
 1190 
 1191 <tr>
 1192   <td colspan="2">
 1193     <label class="checkcell">
 1194       <input type="checkbox" name="elec_chk[]" value="buenas_condiciones">
 1195       <span>Interruptores, extensiones, se encuentran en buenas condiciones</span>
 1196     </label>
 1197   </td>
 1198   <td colspan="2">
 1199     <label class="checkcell">
 1200       <input type="checkbox" name="elec_chk[]" value="aislamiento_ok">
 1201       <span>Los cables mantienen su aislamiento en todo el recorrido (sin peladuras)</span>
 1202     </label>
 1203   </td>
 1204   <td colspan="2">
 1205     <label class="checkcell">
 1206       <input type="checkbox" name="elec_chk[]" value="senalizacion_riesgo">
 1207       <span>Hay señalización de riesgo eléctrico</span>
 1208     </label>
 1209   </td>
 1210 </tr>
 1211 
 1212     <!-- Observaciones -->
 1213     <tr>
 1214       <td class="label-cell">Observaciones:</td>
 1215       <td colspan="5"><textarea class="cell-input" style="height:70px" name="elec_observaciones"></textarea></td>
 1216     </tr>
 1217   </tbody>
 1218 </table>
 1219 
 1220 <!-- ===== RIESGO DE CAÍDA MISMO NIVEL ===== -->
 1221 <div class="bar" style="margin-top:8px;">RIESGO DE CAÍDA MISMO NIVEL</div>
 1222 <table class="sheet">
 1223   <colgroup>
 1224     <col style="width:16.66%"><col style="width:16.66%"><col style="width:16.66%">
 1225     <col style="width:16.66%"><col style="width:16.66%"><col style="width:16.70%">
 1226   </colgroup>
 1227   <tbody>
 1228     <tr>
 1229       <td class="instrucciones" colspan="6">
 1230         Instrucciones: Responder sí o no en la casilla que le corresponde y cualquier observación colocarla en el espacio de observaciones
 1231       </td>
 1232     </tr>
 1233     <tr>
 1234       <td colspan="2">
 1235         <label class="checkcell">
 1236           <input type="checkbox" name="caida_nivel[]" value="pisos_adecuados">
 1237           <span>Estado de pisos es adecuado</span>
 1238         </label>
 1239       </td>
 1240       <td colspan="2">
 1241         <label class="checkcell">
 1242           <input type="checkbox" name="caida_nivel[]" value="vias_libres">
 1243           <span>Las vías de circulación están libres</span>
 1244         </label>
 1245       </td>
 1246       <td colspan="2">
 1247         <label class="checkcell">
 1248           <input type="checkbox" name="caida_nivel[]" value="rampas_identificadas">
 1249           <span>Las rampas o escalones están identificados</span>
 1250         </label>
 1251       </td>
 1252       </tr>
 1253       <tr>
 1254       <td colspan="2">
 1255         <label class="checkcell">
 1256           <input type="checkbox" name="caida_nivel[]" value="gradas_barandas">
 1257           <span>Las gradas tienen barandas o pasamanos</span>
 1258         </label>
 1259       </td>
 1260       <td colspan="2">
 1261         <label class="checkcell">
 1262           <input type="checkbox" name="caida_nivel[]" value="antideslizantes">
 1263           <span>Tienen sistema antideslizante en rampas o gradas</span>
 1264         </label>
 1265       </td>
 1266       <td colspan="2">
 1267         <label class="checkcell">
 1268           <input type="checkbox" name="caida_nivel[]" value="senalizacion_piso_resbaloso">
 1269           <span>Señalización de prevención de riesgo piso resbaloso</span>
 1270         </label>
 1271       </td>
 1272     </tr>
 1273     <tr>
 1274       <td class="label-cell">Observaciones:</td>
 1275       <td colspan="5"><textarea class="cell-input" style="height:70px" name="caida_observaciones"></textarea></td>
 1276     </tr>
 1277   </tbody>
 1278 </table>
 1279 
 1280 <!-- estilos de apoyo -->
 1281 <style>
 1282   .instrucciones{ text-align:center; font-size:12px; padding:6px; }
 1283   .checkcell{ display:flex; align-items:flex-start; gap:8px; padding:8px; }
 1284   .checkcell input[type="checkbox"]{ transform: scale(1.1); margin-top:2px; }
 1285 </style>
 1286 
 1287 <!-- ===== TABLA DE IDENTIFICACIÓN DE RIESGO ===== -->
 1288 <div class="bar" style="margin-top:8px;">TABLA DE IDENTIFICACIÓN DE RIESGO</div>
 1289 <table class="sheet risk-table">
 1290   <thead>
 1291     <tr>
 1292       <th rowspan="2" class="center">TIPO</th>
 1293       <th rowspan="2" class="center">PELIGRO</th>
 1294       <th rowspan="2">RIESGO</th>
 1295       <th rowspan="2">CONSECUENCIA</th>
 1296       <th colspan="2" class="center">APLICA</th>
 1297       <th rowspan="2">OBSERVACIONES</th>
 1298       <th colspan="3" class="center">EVALUACIÓN DEL RIESGO</th>
 1299     </tr>
 1300     <tr>
 1301       <th>SI</th>
 1302       <th>NO</th>
 1303       <th>Probabilidad</th>
 1304       <th>Consecuencia</th>
 1305       <th>Nivel de Riesgo</th>
 1306     </tr>
 1307   </thead>
 1308   <tbody>
 1309     <!-- ========== MECÁNICO (7 filas) ========== -->
 1310     <tr>
 1311       <td class="tipo" rowspan="7">MECANICO</td>
 1312       <td class="label-cell">CAÍDA A DESNIVEL</td>
 1313       <td class="label-cell">Caída a mismo nivel</td>
 1314       <td class="label-cell">Fractura/contusiones</td>
 1315       <td class="center"><input type="radio" name="r0_aplica" value="si"></td>
 1316       <td class="center"><input type="radio" name="r0_aplica" value="no"></td>
 1317       <td><input class="cell-input" name="r0_obs"></td>
 1318       <td>
 1319             <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1320             <datalist id="probabilidad-list">
 1321                 @foreach ($probabilidad as $p)
 1322                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1323                 @endforeach
 1324             </datalist>
 1325       </td>
 1326       <td>
 1327             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1328             <datalist id="consecuencia-list">
 1329                 @foreach ($consecuencia as $p)
 1330                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1331                 @endforeach
 1332             </datalist>
 1333       </td>
 1334       <td><input class="cell-input" name="r0_nivel" placeholder=""></td>
 1335     </tr>
 1336     <tr>
 1337       <td class="label-cell">TRABAJO EN ALTURAS</td>
 1338       <td class="label-cell">Caída a distinto nivel</td>
 1339       <td class="label-cell">Muerte/Fractura/Contusiones</td>
 1340       <td class="center"><input type="radio" name="r1_aplica" value="si"></td>
 1341       <td class="center"><input type="radio" name="r1_aplica" value="no"></td>
 1342       <td><input class="cell-input" name="r1_obs"></td>
 1343       <td>
 1344           <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1345             <datalist id="probabilidad-list">
 1346                 @foreach ($probabilidad as $p)
 1347                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1348                 @endforeach
 1349             </datalist></td>
 1350       <td>
 1351             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1352             <datalist id="consecuencia-list">
 1353                 @foreach ($consecuencia as $p)
 1354                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1355                 @endforeach
 1356             </datalist>
 1357       </td>
 1358       <td><input class="cell-input" name="r1_nivel"></td>
 1359     </tr>
 1360     <tr>
 1361       <td class="label-cell">OBJETOS SUSPENDIDOS</td>
 1362       <td class="label-cell">Caída de Objetos</td>
 1363       <td class="label-cell">Muerte/Fractura/Contusiones</td>
 1364       <td class="center"><input type="radio" name="r2_aplica" value="si"></td>
 1365       <td class="center"><input type="radio" name="r2_aplica" value="no"></td>
 1366       <td><input class="cell-input" name="r2_obs"></td>
 1367       <td>
 1368         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1369             <datalist id="probabilidad-list">
 1370                 @foreach ($probabilidad as $p)
 1371                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1372                 @endforeach
 1373             </datalist>
 1374       </td>
 1375       <td>
 1376             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1377             <datalist id="consecuencia-list">
 1378                 @foreach ($consecuencia as $p)
 1379                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1380                 @endforeach
 1381             </datalist>
 1382       </td>
 1383       <td><input class="cell-input" name="r2_nivel"></td>
 1384     </tr>
 1385     <tr>
 1386       <td class="label-cell">OBJETOS EN MOVIMIENTO Y FIJOS</td>
 1387       <td class="label-cell">Choque contra objetos</td>
 1388       <td class="label-cell">Traumatismo / fractura / contusiones</td>
 1389       <td class="center"><input type="radio" name="r3_aplica" value="si"></td>
 1390       <td class="center"><input type="radio" name="r3_aplica" value="no"></td>
 1391       <td><input class="cell-input" name="r3_obs"></td>
 1392       <td>
 1393         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1394             <datalist id="probabilidad-list">
 1395                 @foreach ($probabilidad as $p)
 1396                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1397                 @endforeach
 1398             </datalist>
 1399       </td>
 1400       <td>
 1401             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1402             <datalist id="consecuencia-list">
 1403                 @foreach ($consecuencia as $p)
 1404                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1405                 @endforeach
 1406             </datalist>
 1407       </td>
 1408       <td><input class="cell-input" name="r3_nivel"></td>
 1409     </tr>
 1410     <tr>
 1411       <td class="label-cell">EQUIPO. HERRAMIENTAS U OBJETOS PUNZOCORTANTES</td>
 1412       <td class="label-cell">Golpes o cortes</td>
 1413       <td class="label-cell">Heridas/cortes/amputaciones</td>
 1414       <td class="center"><input type="radio" name="r4_aplica" value="si"></td>
 1415       <td class="center"><input type="radio" name="r4_aplica" value="no"></td>
 1416       <td><input class="cell-input" name="r4_obs"></td>
 1417       <td>
 1418         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1419             <datalist id="probabilidad-list">
 1420                 @foreach ($probabilidad as $p)
 1421                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1422                 @endforeach
 1423             </datalist>
 1424       </td>
 1425       <td>
 1426             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1427             <datalist id="consecuencia-list">
 1428                 @foreach ($consecuencia as $p)
 1429                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1430                 @endforeach
 1431             </datalist>
 1432       </td>
 1433       <td><input class="cell-input" name="r4_nivel"></td>
 1434     </tr>
 1435     <tr>
 1436       <td class="label-cell">PROYECCIÓN DE FRAGMENTO O PARTÍCULAS</td>
 1437       <td class="label-cell">Impacto de fragmentos sobre las personas</td>
 1438       <td class="label-cell">Golpes/ Fracturas/ Contusiones</td>
 1439       <td class="center"><input type="radio" name="r5_aplica" value="si"></td>
 1440       <td class="center"><input type="radio" name="r5_aplica" value="no"></td>
 1441       <td><input class="cell-input" name="r5_obs"></td>
 1442       <td>
 1443         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1444             <datalist id="probabilidad-list">
 1445                 @foreach ($probabilidad as $p)
 1446                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1447                 @endforeach
 1448             </datalist>
 1449           </td>
 1450       <td>
 1451             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1452             <datalist id="consecuencia-list">
 1453                 @foreach ($consecuencia as $p)
 1454                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1455                 @endforeach
 1456             </datalist>
 1457       </td>
 1458       <td><input class="cell-input" name="r5_nivel"></td>
 1459     </tr>
 1460     <tr>
 1461       <td class="label-cell">MAQUINARIA, EQUIPO O HERRAMIENTAS EN MOVIMIENTO</td>
 1462       <td class="label-cell">Atrapamiento por o entre objetos</td>
 1463       <td class="label-cell">Amputaciones, contusiones/heridas/contusiones</td>
 1464       <td class="center"><input type="radio" name="r6_aplica" value="si"></td>
 1465       <td class="center"><input type="radio" name="r6_aplica" value="no"></td>
 1466       <td><input class="cell-input" name="r6_obs"></td>
 1467       <td>
 1468         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1469             <datalist id="probabilidad-list">
 1470                 @foreach ($probabilidad as $p)
 1471                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1472                 @endforeach
 1473             </datalist>
 1474       </td>
 1475       <td>
 1476             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1477             <datalist id="consecuencia-list">
 1478                 @foreach ($consecuencia as $p)
 1479                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1480                 @endforeach
 1481             </datalist>
 1482       </td>
 1483       <td><input class="cell-input" name="r6_nivel"></td>
 1484     </tr>
 1485 
 1486     <!-- ========== ELÉCTRICO (3 filas) ========== -->
 1487     <tr>
 1488       <td class="tipo" rowspan="3">ELECTRICO</td>
 1489       <td class="label-cell">ALTA O MEDIA TENSION</td>
 1490       <td class="label-cell">Contacto eléctrico directo</td>
 1491       <td class="label-cell">Muerte</td>
 1492       <td class="center"><input type="radio" name="r7_aplica" value="si"></td>
 1493       <td class="center"><input type="radio" name="r7_aplica" value="no"></td>
 1494       <td><input class="cell-input" name="r7_obs"></td>
 1495       <td>
 1496         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1497             <datalist id="probabilidad-list">
 1498                 @foreach ($probabilidad as $p)
 1499                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1500                 @endforeach
 1501             </datalist>
 1502       </td>
 1503       <td>
 1504             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1505             <datalist id="consecuencia-list">
 1506                 @foreach ($consecuencia as $p)
 1507                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1508                 @endforeach
 1509             </datalist>
 1510       </td>
 1511       <td><input class="cell-input" name="r7_nivel"></td>
 1512     </tr>
 1513     <tr>
 1514       <td class="label-cell">BAJA TENSION</td>
 1515       <td class="label-cell">Contacto eléctrico indirecto</td>
 1516       <td class="label-cell">Quemaduras/Muerte</td>
 1517       <td class="center"><input type="radio" name="r8_aplica" value="si"></td>
 1518       <td class="center"><input type="radio" name="r8_aplica" value="no"></td>
 1519       <td><input class="cell-input" name="r8_obs"></td>
 1520       <td>
 1521         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1522             <datalist id="probabilidad-list">
 1523                 @foreach ($probabilidad as $p)
 1524                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1525                 @endforeach
 1526             </datalist>
 1527       </td>
 1528       <td>
 1529             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1530             <datalist id="consecuencia-list">
 1531                 @foreach ($consecuencia as $p)
 1532                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1533                 @endforeach
 1534             </datalist>
 1535       </td>
 1536       <td><input class="cell-input" name="r8_nivel"></td>
 1537     </tr>
 1538     <tr>
 1539       <td class="label-cell">ELECTRICIDAD ESTATICA</td>
 1540       <td class="label-cell">Descarga eléctrica estática—incendio, explosión</td>
 1541       <td class="label-cell">Quemaduras/Muerte</td>
 1542       <td class="center"><input type="radio" name="r9_aplica" value="si"></td>
 1543       <td class="center"><input type="radio" name="r9_aplica" value="no"></td>
 1544       <td><input class="cell-input" name="r9_obs"></td>
 1545       <td>
 1546         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1547             <datalist id="probabilidad-list">
 1548                 @foreach ($probabilidad as $p)
 1549                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1550                 @endforeach
 1551             </datalist>
 1552       </td>
 1553       <td>
 1554             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1555             <datalist id="consecuencia-list">
 1556                 @foreach ($consecuencia as $p)
 1557                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1558                 @endforeach
 1559             </datalist>
 1560       </td>
 1561       <td><input class="cell-input" name="r9_nivel"></td>
 1562     </tr>
 1563 
 1564     <!-- ========== FUEGO Y EXPLOSIÓN (2 filas) ========== -->
 1565     <tr>
 1566       <td class="tipo" rowspan="2">FUEGO Y<br>EXPLOSION</td>
 1567       <td class="label-cell">LIQUIDOS, GASES O MATERIALES COMBUSTIBLES O INFLAMABLES</td>
 1568       <td class="label-cell">Explosión/Incendio</td>
 1569       <td class="label-cell">Quemaduras/Muerte</td>
 1570       <td class="center"><input type="radio" name="r10_aplica" value="si"></td>
 1571       <td class="center"><input type="radio" name="r10_aplica" value="no"></td>
 1572       <td><input class="cell-input" name="r10_obs"></td>
 1573       <td>
 1574         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1575             <datalist id="probabilidad-list">
 1576                 @foreach ($probabilidad as $p)
 1577                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1578                 @endforeach
 1579             </datalist>
 1580       </td>
 1581       <td>
 1582             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1583             <datalist id="consecuencia-list">
 1584                 @foreach ($consecuencia as $p)
 1585                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1586                 @endforeach
 1587             </datalist>
 1588       </td>
 1589       <td><input class="cell-input" name="r10_nivel"></td>
 1590     </tr>
 1591     <tr>
 1592       <td class="label-cell">CILINDROS ALTA PRESION</td>
 1593       <td class="label-cell">Explosión</td>
 1594       <td class="label-cell">Quemaduras/Muerte</td>
 1595       <td class="center"><input type="radio" name="r11_aplica" value="si"></td>
 1596       <td class="center"><input type="radio" name="r11_aplica" value="no"></td>
 1597       <td><input class="cell-input" name="r11_obs"></td>
 1598       <td>
 1599         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1600             <datalist id="probabilidad-list">
 1601                 @foreach ($probabilidad as $p)
 1602                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1603                 @endforeach
 1604             </datalist>
 1605       </td>
 1606       <td>
 1607             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1608             <datalist id="consecuencia-list">
 1609                 @foreach ($consecuencia as $p)
 1610                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1611                 @endforeach
 1612             </datalist>
 1613       </td>
 1614       <td><input class="cell-input" name="r11_nivel"></td>
 1615     </tr>
 1616     <tr>
 1617       <td class="tipo" rowspan="5">FISICO</td>
 1618       <td class="label-cell">RUIDO</td>
 1619       <td class="label-cell">Exposición a Ruido</td>
 1620       <td class="label-cell">Hipoacusia</td>
 1621       <td class="center"><input type="radio" name="r15_aplica" value="si"></td>
 1622       <td class="center"><input type="radio" name="r15_aplica" value="no"></td>
 1623       <td><input class="cell-input" name="r15_obs"></td>
 1624       <td>
 1625         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1626             <datalist id="probabilidad-list">
 1627                 @foreach ($probabilidad as $p)
 1628                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1629                 @endforeach
 1630             </datalist>
 1631       </td>
 1632       <td>
 1633             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1634             <datalist id="consecuencia-list">
 1635                 @foreach ($consecuencia as $p)
 1636                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1637                 @endforeach
 1638             </datalist>
 1639       </td>
 1640       <td><input class="cell-input" name="r15_nivel"></td>
 1641     </tr>
 1642     <tr>
 1643       <td class="label-cell">ESFUERZO FISICO</td>
 1644       <td class="label-cell">-</td>
 1645       <td class="label-cell">-</td>
 1646       <td class="center"><input type="radio" name="r16_aplica" value="si"></td>
 1647       <td class="center"><input type="radio" name="r16_aplica" value="no"></td>
 1648       <td><input class="cell-input" name="r16_obs"></td>
 1649       <td>
 1650         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1651             <datalist id="probabilidad-list">
 1652                 @foreach ($probabilidad as $p)
 1653                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1654                 @endforeach
 1655             </datalist>
 1656       </td>
 1657       <td>
 1658             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1659             <datalist id="consecuencia-list">
 1660                 @foreach ($consecuencia as $p)
 1661                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1662                 @endforeach
 1663             </datalist>
 1664       </td>
 1665       <td><input class="cell-input" name="r16_nivel"></td>
 1666     </tr>
 1667     <tr>
 1668       <td class="label-cell">ESFUERZO VISUAL</td>
 1669       <td class="label-cell">Exposición a radiación luminosa</td>
 1670       <td class="label-cell">Daño a la vista / cansancio visual</td>
 1671       <td class="center"><input type="radio" name="r32_aplica" value="si"></td>
 1672       <td class="center"><input type="radio" name="r32_aplica" value="no"></td>
 1673       <td><input class="cell-input" name="r32_obs"></td>
 1674       <td>
 1675         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1676             <datalist id="probabilidad-list">
 1677                 @foreach ($probabilidad as $p)
 1678                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1679                 @endforeach
 1680             </datalist>
 1681       </td>
 1682       <td>
 1683             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1684             <datalist id="consecuencia-list">
 1685                 @foreach ($consecuencia as $p)
 1686                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1687                 @endforeach
 1688             </datalist>
 1689       </td>
 1690       <td><input class="cell-input" name="r32_nivel"></td>
 1691     </tr>
 1692     <tr>
 1693       <td class="label-cell">VIBRACION</td>
 1694       <td class="label-cell">Exposición a vibraciones</td>
 1695       <td class="label-cell">Trastornos musculoesqueléticos</td>
 1696       <td class="center"><input type="radio" name="r17_aplica" value="si"></td>
 1697       <td class="center"><input type="radio" name="r17_aplica" value="no"></td>
 1698       <td><input class="cell-input" name="r17_obs"></td>
 1699       <td>
 1700         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1701             <datalist id="probabilidad-list">
 1702                 @foreach ($probabilidad as $p)
 1703                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1704                 @endforeach
 1705             </datalist>
 1706       </td>
 1707       <td>
 1708             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1709             <datalist id="consecuencia-list">
 1710                 @foreach ($consecuencia as $p)
 1711                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1712                 @endforeach
 1713             </datalist>
 1714       </td>
 1715       <td><input class="cell-input" name="r17_nivel"></td>
 1716     </tr>
 1717     <tr>
 1718       <td class="label-cell">TEMPERATURAS EXTREMAS (FRIO, CALOR)</td>
 1719       <td class="label-cell">Exposición a temperaturas extremas</td>
 1720       <td class="label-cell">Estrés térmico, quemaduras</td>
 1721       <td class="center"><input type="radio" name="r18_aplica" value="si"></td>
 1722       <td class="center"><input type="radio" name="r18_aplica" value="no"></td>
 1723       <td><input class="cell-input" name="r18_obs"></td>
 1724       <td>
 1725         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1726             <datalist id="probabilidad-list">
 1727                 @foreach ($probabilidad as $p)
 1728                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1729                 @endforeach
 1730             </datalist>
 1731       </td>
 1732       <td>
 1733             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1734             <datalist id="consecuencia-list">
 1735                 @foreach ($consecuencia as $p)
 1736                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1737                 @endforeach
 1738             </datalist>
 1739       </td>
 1740       <td><input class="cell-input" name="r18_nivel"></td>
 1741     </tr>
 1742 
 1743     <!-- ========== BIOLOGICO (3 filas) ========== -->
 1744     <tr>
 1745       <td class="tipo" rowspan="3">BIOLOGICO</td>
 1746       <td class="label-cell">BACTERIAS</td>
 1747       <td class="label-cell">Contacto con ambientes o superficies contaminadas</td>
 1748       <td class="label-cell">Intoxicación / Enfermedades</td>
 1749       <td class="center"><input type="radio" name="r19_aplica" value="si"></td>
 1750       <td class="center"><input type="radio" name="r19_aplica" value="no"></td>
 1751       <td><input class="cell-input" name="r19_obs"></td>
 1752       <td>
 1753         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1754             <datalist id="probabilidad-list">
 1755                 @foreach ($probabilidad as $p)
 1756                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1757                 @endforeach
 1758             </datalist>
 1759       </td>
 1760       <td>
 1761             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1762             <datalist id="consecuencia-list">
 1763                 @foreach ($consecuencia as $p)
 1764                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1765                 @endforeach
 1766             </datalist>
 1767       </td>
 1768       <td><input class="cell-input" name="r19_nivel"></td>
 1769     </tr>
 1770     <tr>
 1771       <td class="label-cell">VIRUS</td>
 1772       <td class="label-cell">Contacto con ambientes o superficies contaminadas</td>
 1773       <td class="label-cell">Intoxicación / Enfermedades</td>
 1774       <td class="center"><input type="radio" name="r20_aplica" value="si"></td>
 1775       <td class="center"><input type="radio" name="r20_aplica" value="no"></td>
 1776       <td><input class="cell-input" name="r20_obs"></td>
 1777       <td>
 1778         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1779             <datalist id="probabilidad-list">
 1780                 @foreach ($probabilidad as $p)
 1781                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1782                 @endforeach
 1783             </datalist>
 1784       </td>
 1785       <td>
 1786             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1787             <datalist id="consecuencia-list">
 1788                 @foreach ($consecuencia as $p)
 1789                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1790                 @endforeach
 1791             </datalist>
 1792       </td>
 1793       <td><input class="cell-input" name="r20_nivel"></td>
 1794     </tr>
 1795     <tr>
 1796       <td class="label-cell">HONGOS</td>
 1797       <td class="label-cell">Contacto o exposición</td>
 1798       <td class="label-cell">Intoxicación / Enfermedades</td>
 1799       <td class="center"><input type="radio" name="r21_aplica" value="si"></td>
 1800       <td class="center"><input type="radio" name="r21_aplica" value="no"></td>
 1801       <td><input class="cell-input" name="r21_obs"></td>
 1802       <td>
 1803         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1804             <datalist id="probabilidad-list">
 1805                 @foreach ($probabilidad as $p)
 1806                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1807                 @endforeach
 1808             </datalist>
 1809       </td>
 1810       <td>
 1811             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1812             <datalist id="consecuencia-list">
 1813                 @foreach ($consecuencia as $p)
 1814                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1815                 @endforeach
 1816             </datalist>
 1817       </td>
 1818       <td><input class="cell-input" name="r21_nivel"></td>
 1819     </tr>
 1820 
 1821     <!-- ========== ERGONOMICO (4 filas) ========== -->
 1822     <tr>
 1823       <td class="tipo" rowspan="4">ERGONOMICO</td>
 1824       <td class="label-cell">CARGA FÍSICA CON POSTURA FORZADA/PARADO U SENTADO</td>
 1825       <td class="label-cell">Sobreesfuerzo</td>
 1826       <td class="label-cell">Trastornos musculoesqueléticos</td>
 1827       <td class="center"><input type="radio" name="r22_aplica" value="si"></td>
 1828       <td class="center"><input type="radio" name="r22_aplica" value="no"></td>
 1829       <td><input class="cell-input" name="r22_obs"></td>
 1830       <td>
 1831         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1832             <datalist id="probabilidad-list">
 1833                 @foreach ($probabilidad as $p)
 1834                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1835                 @endforeach
 1836             </datalist>
 1837       </td>
 1838       <td>
 1839             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1840             <datalist id="consecuencia-list">
 1841                 @foreach ($consecuencia as $p)
 1842                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1843                 @endforeach
 1844             </datalist>
 1845       </td>
 1846       <td><input class="cell-input" name="r22_nivel"></td>
 1847     </tr>
 1848     <tr>
 1849       <td class="label-cell">CARGA FÍSICA POR LEVANTAR/MANEJAR OBJETOS PESADOS O HACERLO INADECUADAMENTE</td>
 1850       <td class="label-cell">Sobreesfuerzo</td>
 1851       <td class="label-cell">Lumbalgia</td>
 1852       <td class="center"><input type="radio" name="r23_aplica" value="si"></td>
 1853       <td class="center"><input type="radio" name="r23_aplica" value="no"></td>
 1854       <td><input class="cell-input" name="r23_obs"></td>
 1855       <td>
 1856         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1857             <datalist id="probabilidad-list">
 1858                 @foreach ($probabilidad as $p)
 1859                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1860                 @endforeach
 1861             </datalist>
 1862       </td>
 1863       <td>
 1864             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1865             <datalist id="consecuencia-list">
 1866                 @foreach ($consecuencia as $p)
 1867                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1868                 @endforeach
 1869             </datalist>
 1870       </td>
 1871       <td><input class="cell-input" name="r23_nivel"></td>
 1872     </tr>
 1873     <tr>
 1874       <td class="label-cell">TAREAS REPETITIVAS</td>
 1875       <td class="label-cell">Probabilidad del daño</td>
 1876       <td class="label-cell">Trastornos musculoesqueléticos</td>
 1877       <td class="center"><input type="radio" name="r24_aplica" value="si"></td>
 1878       <td class="center"><input type="radio" name="r24_aplica" value="no"></td>
 1879       <td><input class="cell-input" name="r24_obs"></td>
 1880       <td>
 1881         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1882             <datalist id="probabilidad-list">
 1883                 @foreach ($probabilidad as $p)
 1884                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1885                 @endforeach
 1886             </datalist>
 1887       </td>
 1888       <td>
 1889             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1890             <datalist id="consecuencia-list">
 1891                 @foreach ($consecuencia as $p)
 1892                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1893                 @endforeach
 1894             </datalist>
 1895       </td>
 1896       <td><input class="cell-input" name="r24_nivel"></td>
 1897     </tr>
 1898     <tr>
 1899       <td class="label-cell">PROBLEMAS DEL DISEÑO DE LUGAR DE TRABAJO</td>
 1900       <td class="label-cell">Probabilidad del daño</td>
 1901       <td class="label-cell">Trastornos musculoesqueléticos</td>
 1902       <td class="center"><input type="radio" name="r25_aplica" value="si"></td>
 1903       <td class="center"><input type="radio" name="r25_aplica" value="no"></td>
 1904       <td><input class="cell-input" name="r25_obs"></td>
 1905       <td>
 1906         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1907             <datalist id="probabilidad-list">
 1908                 @foreach ($probabilidad as $p)
 1909                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1910                 @endforeach
 1911             </datalist>
 1912       </td>
 1913       <td>
 1914             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1915             <datalist id="consecuencia-list">
 1916                 @foreach ($consecuencia as $p)
 1917                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1918                 @endforeach
 1919             </datalist>
 1920       </td>
 1921       <td><input class="cell-input" name="r25_nivel"></td>
 1922     </tr>
 1923 
 1924     <!-- ========== LOCATIVO (3 filas) ========== -->
 1925     <tr>
 1926       <td class="tipo" rowspan="3">LOCATIVO</td>
 1927       <td class="label-cell">ESCALERAS Y RAMPAS MAL DISEÑADAS</td>
 1928       <td class="label-cell">Caída y golpes</td>
 1929       <td class="label-cell">Fractura / contusiones</td>
 1930       <td class="center"><input type="radio" name="r26_aplica" value="si"></td>
 1931       <td class="center"><input type="radio" name="r26_aplica" value="no"></td>
 1932       <td><input class="cell-input" name="r26_obs"></td>
 1933       <td>
 1934         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1935             <datalist id="probabilidad-list">
 1936                 @foreach ($probabilidad as $p)
 1937                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1938                 @endforeach
 1939             </datalist>
 1940       </td>
 1941       <td>
 1942             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1943             <datalist id="consecuencia-list">
 1944                 @foreach ($consecuencia as $p)
 1945                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1946                 @endforeach
 1947             </datalist>
 1948       </td>
 1949       <td><input class="cell-input" name="r26_nivel"></td>
 1950     </tr>
 1951     <tr>
 1952       <td class="label-cell">DISEÑO DE VÍAS DE EVACUACIÓN (ANCHO, PENDIENTE, ALTURA)</td>
 1953       <td class="label-cell">Caída y golpes</td>
 1954       <td class="label-cell">Fractura / contusiones</td>
 1955       <td class="center"><input type="radio" name="r27_aplica" value="si"></td>
 1956       <td class="center"><input type="radio" name="r27_aplica" value="no"></td>
 1957       <td><input class="cell-input" name="r27_obs"></td>
 1958       <td>
 1959         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1960             <datalist id="probabilidad-list">
 1961                 @foreach ($probabilidad as $p)
 1962                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1963                 @endforeach
 1964             </datalist>
 1965       </td>
 1966       <td>
 1967             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1968             <datalist id="consecuencia-list">
 1969                 @foreach ($consecuencia as $p)
 1970                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1971                 @endforeach
 1972             </datalist>
 1973       </td>
 1974       <td><input class="cell-input" name="r27_nivel"></td>
 1975     </tr>
 1976     <tr>
 1977       <td class="label-cell">INFRAESTRUCTURA INADECUADA (TECHOS BAJOS, AREA REDUCIDA, SUPERFICIE DEFECTUOSA)</td>
 1978       <td class="label-cell">Caída y golpes</td>
 1979       <td class="label-cell">Fractura / contusiones</td>
 1980       <td class="center"><input type="radio" name="r28_aplica" value="si"></td>
 1981       <td class="center"><input type="radio" name="r28_aplica" value="no"></td>
 1982       <td><input class="cell-input" name="r28_obs"></td>
 1983       <td>
 1984         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1985             <datalist id="probabilidad-list">
 1986                 @foreach ($probabilidad as $p)
 1987                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 1988                 @endforeach
 1989             </datalist>
 1990       </td>
 1991       <td>
 1992             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 1993             <datalist id="consecuencia-list">
 1994                 @foreach ($consecuencia as $p)
 1995                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 1996                 @endforeach
 1997             </datalist>
 1998       </td>
 1999       <td><input class="cell-input" name="r28_nivel"></td>
 2000     </tr>
 2001 
 2002     <!-- ========== PSICOSOCIALES (2 filas) ========== -->
 2003     <tr>
 2004       <td class="tipo" rowspan="2">PSICOSOCIALES</td>
 2005       <td class="label-cell">CARGA DE TRABAJO</td>
 2006       <td class="label-cell">Estrés laboral</td>
 2007       <td class="label-cell">Afecciones al sistema de respuesta fisiológica, cognitiva y motora</td>
 2008       <td class="center"><input type="radio" name="r29_aplica" value="si"></td>
 2009       <td class="center"><input type="radio" name="r29_aplica" value="no"></td>
 2010       <td><input class="cell-input" name="r29_obs"></td>
 2011       <td>
 2012         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 2013             <datalist id="probabilidad-list">
 2014                 @foreach ($probabilidad as $p)
 2015                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 2016                 @endforeach
 2017             </datalist>
 2018       </td>
 2019       <td>
 2020             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 2021             <datalist id="consecuencia-list">
 2022                 @foreach ($consecuencia as $p)
 2023                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 2024                 @endforeach
 2025             </datalist>
 2026       </td>
 2027       <td><input class="cell-input" name="r29_nivel"></td>
 2028     </tr>
 2029     <tr>
 2030       <td class="label-cell">HOSTIGAMIENTO LABORAL</td>
 2031       <td class="label-cell">Estrés laboral</td>
 2032       <td class="label-cell">Afecciones al sistema de respuesta fisiológica, cognitiva y motora</td>
 2033       <td class="center"><input type="radio" name="r30_aplica" value="si"></td>
 2034       <td class="center"><input type="radio" name="r30_aplica" value="no"></td>
 2035       <td><input class="cell-input" name="r30_obs"></td>
 2036       <td>
 2037         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 2038             <datalist id="probabilidad-list">
 2039                 @foreach ($probabilidad as $p)
 2040                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 2041                 @endforeach
 2042             </datalist>
 2043       </td>
 2044       <td>
 2045             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 2046             <datalist id="consecuencia-list">
 2047                 @foreach ($consecuencia as $p)
 2048                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 2049                 @endforeach
 2050             </datalist>
 2051       </td>
 2052       <td><input class="cell-input" name="r30_nivel"></td>
 2053     </tr>
 2054 
 2055     <!-- ========== FENOMENOS AMBIENTALES (1 fila) ========== -->
 2056     <tr>
 2057       <td class="tipo" rowspan="1">FENOMENOS<br>AMBIENTALES</td>
 2058       <td class="label-cell">LLUVIA, TERREMOTOS, RAYOS, DESBORDE DE RÍOS</td>
 2059       <td class="label-cell">Inundaciones, caída de objetos por derrumbe, descarga eléctrica</td>
 2060       <td class="label-cell">Ahogamiento / Politraumatismos / Quemaduras / Muerte</td>
 2061       <td class="center"><input type="radio" name="r31_aplica" value="si"></td>
 2062       <td class="center"><input type="radio" name="r31_aplica" value="no"></td>
 2063       <td><input class="cell-input" name="r31_obs"></td>
 2064       <td>
 2065         <input type="text" id="probabilidad-input" list="probabilidad-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 2066             <datalist id="probabilidad-list">
 2067                 @foreach ($probabilidad as $p)
 2068                     <option data-id="{{ $p->id_probabilidad }}" value="{{ $p->probabilidad }}"></option>
 2069                 @endforeach
 2070             </datalist>
 2071       </td>
 2072       <td>
 2073             <input type="text" id="consecuencia-input" list="consecuencia-list" class="cell-input" placeholder="Escribe para buscar…" autocomplete="off" style="font-size:10px;">
 2074             <datalist id="consecuencia-list">
 2075                 @foreach ($consecuencia as $p)
 2076                     <option data-id="{{ $p->id_consecuencia }}" value="{{ $p->consecuencia }}"></option>
 2077                 @endforeach
 2078             </datalist>
 2079       </td>
 2080       <td><input class="cell-input" name="r31_nivel" style="font-size:10px;"></td>
 2081     </tr>
 2082   </tbody>
 2083 </table>
 2084 
 2085 <style>
 2086   /* Encabezados grises como el resto del formato */
 2087   .risk-table thead th{
 2088     background:#bfbfbf; font-weight:700; text-align:center; padding:6px;
 2089   }
 2090   .risk-table .tipo{
 2091     text-transform:uppercase; font-weight:700; text-align:center; vertical-align:middle;
 2092     background:#eee;
 2093   }
 2094   .risk-table input[type="radio"]{ transform:scale(1.1); }
 2095 </style>
 2096 
 2097 
 2098 <!-- ===== TABLA DE IDENTIFICACIÓN DE RIESGO (continuación) ===== -->
 2099 <style>
 2100   .cell-select{ width:100%; border:0; padding:8px; font:inherit; background:transparent; outline:none; appearance:none; }
 2101 </style>
 2102 
 2103 <!-- ===== FIRMAS Y FECHAS ===== -->
 2104 <table class="sheet" style="margin-top:8px;">
 2105   <colgroup>
 2106     <col style="width:20%">
 2107     <col style="width:40%">
 2108     <col style="width:10%">
 2109     <col style="width:30%">
 2110   </colgroup>
 2111   <tbody>
 2112     <tr>
 2113       <td class="label-cell">Evaluación realizada por:</td>
 2114       <td><input class="cell-input" name="eval_realizada_por"></td>
 2115       <td class="label-cell center">Fecha</td>
 2116       <td><input class="cell-input" type="date" name="eval_realizada_fecha"></td>
 2117     </tr>
 2118     <tr>
 2119       <td class="label-cell">Evaluación revisada por:</td>
 2120       <td><input class="cell-input" name="eval_revisada_por"></td>
 2121       <td class="label-cell center">Fecha</td>
 2122       <td><input class="cell-input" type="date" name="eval_revisada_fecha"></td>
 2123     </tr>
 2124     <tr>
 2125       <td class="label-cell">Fecha próxima evaluación:</td>
 2126       <td colspan="3"><input class="cell-input" type="date" name="fecha_proxima_evaluacion"></td>
 2127     </tr>
 2128   </tbody>
 2129 </table>
 2130 
 2131   <script>
 2132   document.addEventListener('DOMContentLoaded', () => {
 2133     // Reusa ensureHidden(tr, name) si ya la definiste arriba
 2134     function _ensureHidden(container, name){
 2135       let el = container.querySelector('input[type="hidden"][name="'+name+'"]');
 2136       if (!el) { el = document.createElement('input'); el.type='hidden'; el.name=name; container.appendChild(el); }
 2137       return el;
 2138     }
 2139     document.querySelectorAll('.risk-table tbody tr').forEach(tr => {
 2140       const aplica = tr.querySelector('input[type="radio"][name^="r"][name$="_aplica"]');
 2141       const obs    = tr.querySelector('input[name^="r"][name$="_obs"]');
 2142       if (!aplica || !obs) return; // no es una fila de riesgo
 2143 
 2144       const m = aplica.name.match(/^r(\d+)_/);
 2145       if (!m) return;
 2146       const idx = m[1];
 2147 
 2148       // La primera label-cell de la fila es la columna PELIGRO
 2149       const peligroCell = tr.querySelector('td.label-cell');
 2150       const peligro = (peligroCell ? peligroCell.textContent : '').trim();
 2151 
 2152       _ensureHidden(tr, `riesgos[${idx}][nombre]`).value = peligro;
 2153     });
 2154   });
 2155 </script>
 2156 
 2157   <div class="actions">
 2158     <button class="btn-guardar" type="submit">Guardar</button>
 2159   </div>
 2160 </form>
 2161 
 2162   </div>
 2163 
 2164 <script>
 2165 document.addEventListener('DOMContentLoaded', () => {
 2166   /* ===== Autollenado de puesto -> depto / num_empleados / id ===== */
 2167   const puestoInput = document.getElementById('puesto-input');
 2168 const deptoInput  = document.querySelector('input[name="departamento"]');
 2169 const numInput    = document.querySelector('input[name="ptm_num_empleados"]');
 2170 const descInput   = document.querySelector('textarea[name="ptm_descripcion_general"]');
 2171 const actsInput   = document.querySelector('textarea[name="ptm_actividades_diarias"]');
 2172 const objInput    = document.querySelector('textarea[name="ptm_objetivo_puesto"]');
 2173 const hiddenId    = document.getElementById('puesto_id');
 2174 const puestosData = @json($puestos);
 2175 const norm = v => (v||'').toString().trim().toLowerCase();
 2176 
 2177 function actualizarDesdeSeleccion() {
 2178   const valor = puestoInput?.value || '';
 2179   const match = (puestosData || []).find(p => norm(p.puesto_trabajo_matriz) === norm(valor));
 2180   if (match) {
 2181     deptoInput.value = match.departamento || '';
 2182     numInput.value   = match.num_empleados ?? '';
 2183     descInput.value  = match.descripcion_general || '';
 2184     actsInput.value  = match.actividades_diarias || '';
 2185     objInput.value   = match.objetivo_puesto || '';
 2186     hiddenId.value   = match.id_puesto_trabajo_matriz;
 2187   } else {
 2188     deptoInput.value = '';
 2189     numInput.value = '';
 2190     descInput.value = '';
 2191     actsInput.value = '';
 2192     objInput.value = '';
 2193     hiddenId.value = '';
 2194   }
 2195 }
 2196 
 2197 // precarga por ID si viene del servidor
 2198 const initialId = "{{ $id_puesto_trabajo_matriz ?? '' }}";
 2199 if (initialId && puestosData?.length) {
 2200   const m = puestosData.find(p => String(p.id_puesto_trabajo_matriz) === String(initialId));
 2201   if (m && puestoInput) puestoInput.value = m.puesto_trabajo_matriz;
 2202 }
 2203 actualizarDesdeSeleccion();
 2204 puestoInput?.addEventListener('input', actualizarDesdeSeleccion);
 2205 puestoInput?.addEventListener('change', actualizarDesdeSeleccion);
 2206 
 2207   document.getElementById('riesgos-form')?.addEventListener('submit', e => {
 2208     if (!hiddenId?.value) {
 2209       e.preventDefault();
 2210       alert('Selecciona un puesto válido de la lista.');
 2211       puestoInput?.focus();
 2212     }
 2213   });
 2214 
 2215   /* ===== Autocompletar: Probabilidad + Consecuencia => Nivel (y IDs ocultos) ===== */
 2216   const VALORACIONES = @json($valoracionTabla ?? []);
 2217 
 2218   const NIVEL_COLOR_BY_ID = { '5':'#ff0000', '4':'#be5014', '3':'#ffc000', '2':'#ffff00', '1':'#92d050' };
 2219   const NIVEL_COLOR_BY_LABEL = {
 2220     'RIESGO MUY ALTO':'#ff0000','MUY ALTO':'#ff0000',
 2221     'RIESGO ALTO':'#be5014','ALTO':'#be5014',
 2222     'RIESGO MEDIO':'#ffc000','MEDIO':'#ffc000',
 2223     'RIESGO BAJO':'#ffff00','BAJO':'#ffff00',
 2224     'RIESGO IRRELEVANTE':'#92d050','IRRELEVANTE':'#92d050'
 2225   };
 2226 
 2227   function getIdFromDatalist(listId, value){
 2228     const dl = document.getElementById(listId);
 2229     if (!dl) return null;
 2230     const v = (value||'').trim().toLowerCase();
 2231     const opt = Array.from(dl.options || []).find(o => (o.value||'').trim().toLowerCase() === v);
 2232     return opt ? (opt.getAttribute('data-id') || null) : null;
 2233   }
 2234 
 2235   function ensureHidden(container, name){
 2236     let el = container.querySelector(`input[type="hidden"][name="${name}"]`);
 2237     if (!el) { el = document.createElement('input'); el.type='hidden'; el.name=name; container.appendChild(el); }
 2238     return el;
 2239   }
 2240 
 2241   function findNivelRecord(probId, consId){
 2242     return (VALORACIONES || []).find(v =>
 2243       String(v.id_probabilidad)===String(probId) && String(v.id_consecuencia)===String(consId)
 2244     );
 2245   }
 2246 
 2247   function nivelColor(nivelLabel, nivelId){
 2248     if (nivelId && NIVEL_COLOR_BY_ID[String(nivelId)]) return NIVEL_COLOR_BY_ID[String(nivelId)];
 2249     const key = (nivelLabel||'').toString().trim().toUpperCase();
 2250     return NIVEL_COLOR_BY_LABEL[key] || '';
 2251   }
 2252 
 2253   function updateRow(tr){
 2254     const probInput  = tr.querySelector('input[list="probabilidad-list"]');
 2255     const consInput  = tr.querySelector('input[list="consecuencia-list"]');
 2256     const nivelInput = tr.querySelector('input[name$="_nivel"]');
 2257     if (!probInput || !consInput || !nivelInput) return;
 2258 
 2259     const prefix = (nivelInput.name || '').replace(/_nivel$/, '');
 2260 
 2261     const probId = getIdFromDatalist('probabilidad-list', probInput.value);
 2262     const consId = getIdFromDatalist('consecuencia-list', consInput.value);
 2263 
 2264     ensureHidden(tr, `${prefix}_id_probabilidad`).value = probId || '';
 2265     ensureHidden(tr, `${prefix}_id_consecuencia`).value = consId || '';
 2266 
 2267     let nivelLabel = '', nivelId = '';
 2268     if (probId && consId) {
 2269       const rec = findNivelRecord(probId, consId);
 2270       if (rec) { nivelLabel = rec.nivel_riesgo || ''; nivelId = rec.id_nivel_riesgo || ''; }
 2271     }
 2272 
 2273     // visible
 2274     nivelInput.value = nivelLabel || (nivelId ? String(nivelId) : '');
 2275     const color = nivelColor(nivelLabel, nivelId);
 2276     if (color) {
 2277       Object.assign(nivelInput.style, { backgroundColor: color, color:'#000', fontWeight:'700', textAlign:'center' });
 2278     } else {
 2279       Object.assign(nivelInput.style, { backgroundColor: '', color:'', fontWeight:'', textAlign:'' });
 2280     }
 2281 
 2282     // oculto
 2283     ensureHidden(tr, `${prefix}_id_nivel_riesgo`).value = nivelId || '';
 2284   }
 2285 
 2286   // Enlazar a todas las filas que tengan prob/cons/nivel
 2287   document.querySelectorAll('table.sheet tbody tr').forEach(tr => {
 2288     const p = tr.querySelector('input[list="probabilidad-list"]');
 2289     const c = tr.querySelector('input[list="consecuencia-list"]');
 2290     const n = tr.querySelector('input[name$="_nivel"]');
 2291     if (p && c && n) {
 2292       ['input','change'].forEach(evt => {
 2293         p.addEventListener(evt, () => updateRow(tr));
 2294         c.addEventListener(evt, () => updateRow(tr));
 2295       });
 2296       updateRow(tr); // inicial
 2297     }
 2298   });
 2299 });
 2300 </script>
 2301 
 2302 <script>
 2303 document.addEventListener('DOMContentLoaded', () => {
 2304   const RIESGOS_CAT = @json($riesgos ?? []); // debe traer id_riesgo y nombre_riesgo
 2305   const normalize = s => (s||'').normalize('NFD').replace(/\p{Diacritic}/gu,'').toLowerCase().trim();
 2306 
 2307   // acepta nombre_riesgo y (por compatibilidad) peligro si así te llega
 2308   const ID_BY_NOMBRE = Object.fromEntries(
 2309     (RIESGOS_CAT || []).map(r => [ normalize(r.nombre_riesgo || r.peligro || ''), r.id_riesgo ])
 2310   );
 2311 
 2312   function ensureHidden(container, name){
 2313     let el = container.querySelector(`input[type="hidden"][name="${name}"]`);
 2314     if (!el) { el = document.createElement('input'); el.type='hidden'; el.name=name; container.appendChild(el); }
 2315     return el;
 2316   }
 2317 
 2318   document.querySelectorAll('table.risk-table tbody tr').forEach(tr => {
 2319     const any = tr.querySelector('input[name^="r"][name$="_obs"], input[name^="r"][name$="_nivel"], input[name^="r"][name$="_aplica"]');
 2320     if (!any) return;
 2321     const m = any.name.match(/^r(\d+)_/); if (!m) return;
 2322     const idx = m[1];
 2323 
 2324     const peligroCell = tr.querySelector('td.label-cell');                 // 1ª label-cell = PELIGRO
 2325     const peligroTxt  = (peligroCell?.textContent || '').trim();
 2326     const idRiesgo    = ID_BY_NOMBRE[ normalize(peligroTxt) ] || '';
 2327 
 2328     // backend leerá esto
 2329     ensureHidden(tr, `riesgos[${idx}][id_riesgo]`).value = idRiesgo;
 2330     ensureHidden(tr, `riesgos[${idx}][nombre]`).value    = peligroTxt; // respaldo por nombre
 2331   });
 2332 });
 2333 </script>
 2334 
 2335 <script>
 2336 document.addEventListener('DOMContentLoaded', () => {
 2337   const form = document.getElementById('riesgos-form');
 2338   const fetchBase = form?.dataset.fetchBase || '';
 2339   const puestoInput = document.getElementById('puesto-input');
 2340   const hiddenId    = document.getElementById('puesto_id');
 2341 
 2342   // Helpers DOM
 2343   const q  = sel => form.querySelector(sel);
 2344   const qa = sel => Array.from(form.querySelectorAll(sel));
 2345   const setVal = (name, val) => { const el = q(`[name="${name}"]`); if (el) el.value = val ?? ''; };
 2346   const setRadio = (name, val) => {
 2347     qa(`input[type="radio"][name="${name}"]`).forEach(r => r.checked = (r.value === String(val)));
 2348   };
 2349   const setCheck = (name, shouldCheck) => {
 2350     // name es "posturas[]" o "elec_chk[]", etc. Seleccionamos por value
 2351     const el = q(`input[type="checkbox"][name="${name[0]}"][value="${name[1]}"]`);
 2352     if (el) el.checked = !!shouldCheck;
 2353   };
 2354   const setSelect = (name, val) => setVal(name, val);
 2355 
 2356   // Datalist: dado un data-id, poner el label correcto en el input asociado a 'list'
 2357   function valueFromDataId(listId, dataId){
 2358     const dl = document.getElementById(listId);
 2359     if (!dl) return '';
 2360     const opt = Array.from(dl.options||[]).find(o => String(o.getAttribute('data-id')) === String(dataId));
 2361     return opt ? (opt.value || '') : '';
 2362   }
 2363 
 2364   // Aplica colores al nivel
 2365   function setNivelStyle(input, bg){
 2366     if (!input) return;
 2367     if (!bg){ input.style.backgroundColor=''; input.style.fontWeight=''; input.style.textAlign=''; input.style.color=''; return; }
 2368     input.style.backgroundColor = bg;
 2369     input.style.fontWeight = '700';
 2370     input.style.textAlign = 'center';
 2371     input.style.color = '#000';
 2372   }
 2373 
 2374   // Rellena quimicos (tabla dinámica)
 2375   function fillQuimicos(rows){
 2376     const tabla = document.getElementById('tabla-quimicos');
 2377     const tbody = tabla?.querySelector('tbody');
 2378     if (!tbody) return;
 2379     // limpiar dejando 1 fila
 2380     qa('#tabla-quimicos tbody tr').slice(1).forEach(tr => tr.remove());
 2381     const base = tbody.querySelector('tr') || null;
 2382     if (!base) return;
 2383     // limpiar base
 2384     base.querySelectorAll('input').forEach(i => i.value = '');
 2385     // si no hay data, queda la base vacía
 2386     if (!rows || !rows.length) return;
 2387     // primera fila
 2388     const first = rows[0];
 2389     base.querySelector('.quimico-id').value = first.id_quimico ?? '';
 2390     base.querySelector('.quimico-nombre').value = first.nombre ?? '';
 2391     q(`[name="quimicos[0][duracion]"]`).value = first.duracion ?? '';
 2392     q(`[name="quimicos[0][frecuencia]"]`).value = first.frecuencia ?? '';
 2393     // resto
 2394     for (let i=1;i<rows.length;i++){
 2395       const clon = base.cloneNode(true);
 2396       tbody.appendChild(clon);
 2397       clon.querySelectorAll('input').forEach(inp => inp.value = '');
 2398       clon.querySelector('.quimico-id').name = `quimicos[${i}][id_quimico]`;
 2399       clon.querySelector('.quimico-nombre').name = `quimicos[${i}][nombre]`;
 2400       clon.querySelector('.quimico-id').value = rows[i].id_quimico ?? '';
 2401       clon.querySelector('.quimico-nombre').value = rows[i].nombre ?? '';
 2402       clon.querySelector('[name^="quimicos["][name$="[duracion]"]').name = `quimicos[${i}][duracion]`;
 2403       clon.querySelector('[name^="quimicos["][name$="[frecuencia]"]').name = `quimicos[${i}][frecuencia]`;
 2404       clon.querySelector(`[name="quimicos[${i}][duracion]"]`).value = rows[i].duracion ?? '';
 2405       clon.querySelector(`[name="quimicos[${i}][frecuencia]"]`).value = rows[i].frecuencia ?? '';
 2406     }
 2407     // actualiza botones +/- (reusa tu lógica)
 2408     const evt = new Event('click',{bubbles:true});
 2409     const lastBtn = tbody.querySelector('.icon-btn.add');
 2410     if (!lastBtn) { /* no-op, tu init ya ordena */ }
 2411   }
 2412 
 2413   // Rellena radios con arreglo {estado, obs}
 2414   function fillEstadoObs(prefix, arr){
 2415     if (!arr) return;
 2416     arr.forEach((row, i) => {
 2417       if (row?.estado) setRadio(`${prefix}[${i}][estado]`, row.estado);
 2418       setVal(`${prefix}[${i}][obs]`, row?.obs ?? '');
 2419     });
 2420   }
 2421 
 2422   // Rellena ergonomía: ergo[i][resp]/[obs]
 2423   function fillErgo(ergo){
 2424     if (!ergo) return;
 2425     ergo.forEach((row, i) => {
 2426       if (row?.resp) setRadio(`ergo[${i}][resp]`, row.resp);
 2427       setVal(`ergo[${i}][obs]`, row?.obs ?? '');
 2428     });
 2429   }
 2430 
 2431   // Rellena checkboxes tipo matriz
 2432   function fillCheckMatrix(map, groupName){
 2433     if (!map) return;
 2434     Object.entries(map).forEach(([k,v]) => {
 2435       const el = q(`input[type="checkbox"][name="${groupName}"][value="${k}"]`);
 2436       if (el) el.checked = !!v;
 2437     });
 2438   }
 2439 
 2440   // Rellena select de fuego
 2441   function fillFuego(f){
 2442     if (!f) return;
 2443     Object.entries(f).forEach(([k,v]) => setSelect(`riesgo_fuego[${k}]`, v || ''));
 2444   }
 2445 
 2446   // Rellena eléctricos (selects + checks)
 2447   function fillElec(sel, chk){
 2448     if (sel) {
 2449       Object.entries(sel).forEach(([k,v]) => setSelect(k, v || ''));
 2450     }
 2451     if (chk) {
 2452       Object.entries(chk).forEach(([k,v]) => {
 2453         const el = q(`input[type="checkbox"][name="elec_chk[]"][value="${k}"]`);
 2454         if (el) el.checked = !!v;
 2455       });
 2456     }
 2457   }
 2458 
 2459   // Rellena alt/firmas/visuales/ruido/termico simples
 2460   function fillSimpleBlocks(payload){
 2461     // Visual / Ruido / Térmico
 2462     if (payload.visual){
 2463       setVal('visual_tipo', payload.visual.tipo || '');
 2464       setVal('visual_tiempo', payload.visual.tiempo || '');
 2465     }
 2466     if (payload.ruido){
 2467       setVal('ruido_desc', payload.ruido.desc || '');
 2468       setVal('ruido_duracion', payload.ruido.tiempo || '');
 2469     }
 2470     if (payload.termico){
 2471       setVal('termico_desc', payload.termico.desc || '');
 2472       setVal('termico_duracion', payload.termico.tiempo || '');
 2473     }
 2474     // Físico
 2475     const F = payload.fisico || {};
 2476     const putFis = (k, obj) => {
 2477       setVal(`fisico_${k}_desc`, obj?.desc||'');
 2478       setVal(`fisico_${k}_equipo`, obj?.equipo||'');
 2479       setVal(`fisico_${k}_duracion`, obj?.duracion||'');
 2480       setVal(`fisico_${k}_distancia`, obj?.distancia||'');
 2481       setVal(`fisico_${k}_epp`, obj?.epp||'');
 2482       setVal(`fisico_${k}_frecuencia`, obj?.frecuencia||'');
 2483       setVal(`fisico_${k}_peso`, obj?.peso||'');
 2484     };
 2485     ['cargar','halar','empujar','sujetar'].forEach(k => putFis(k, F[k]));
 2486 
 2487     // Alturas
 2488     if (payload.alturas){
 2489       setVal('alturas[altura]', payload.alturas.altura || '');
 2490       setVal('alturas[anclaje_seguro]', payload.alturas.anclaje_seguro || '');
 2491       setVal('alturas[aviso_trabajo_altura]', payload.alturas.aviso_trabajo_altura || '');
 2492       setVal('alturas[firma_trabajo_seguro]', payload.alturas.firma_trabajo_seguro || '');
 2493     }
 2494 
 2495     // Firmas/fechas
 2496     if (payload.firmas){
 2497       setVal('eval_realizada_por', payload.firmas.eval_realizada_por || '');
 2498       setVal('eval_realizada_fecha', payload.firmas.eval_realizada_fecha || '');
 2499       setVal('eval_revisada_por', payload.firmas.eval_revisada_por || '');
 2500       setVal('eval_revisada_fecha', payload.firmas.eval_revisada_fecha || '');
 2501       setVal('fecha_proxima_evaluacion', payload.firmas.fecha_proxima_evaluacion || '');
 2502     }
 2503   }
 2504 
 2505   // Rellena la tabla de RIESGOS fila por fila usando id_riesgo oculto
 2506   function fillRiesgos(riesgoValor, evalMap){
 2507     // Asegura que ya se generaron los inputs ocultos de id_riesgo:
 2508     // (tu script de mapeo por catálogo ya lo hace en DOMContentLoaded)
 2509 
 2510     qa('table.risk-table tbody tr').forEach(tr => {
 2511       const any = tr.querySelector('input[name^="r"][name$="_obs"], input[name^="r"][name$="_nivel"], input[name^="r"][name$="_aplica"]');
 2512       if (!any) return;
 2513       const m = any.name.match(/^r(\d+)_/); if (!m) return;
 2514       const i = m[1];
 2515       const hid = tr.querySelector(`input[type="hidden"][name="riesgos[${i}][id_riesgo]"]`);
 2516       const rid = hid?.value ? parseInt(hid.value, 10) : null;
 2517       if (!rid) return;
 2518 
 2519       // valor/obs
 2520       const rv = riesgoValor && riesgoValor[rid] ? riesgoValor[rid] : null;
 2521       if (rv && rv.valor) setRadio(`r${i}_aplica`, rv.valor); // "si"|"no"
 2522       if (rv && (rv.obs ?? '') !== '') setVal(`r${i}_obs`, rv.obs);
 2523 
 2524       // prob/cons/nivel → ponemos los labels en inputs con datalist y disparamos tu updateRow(tr)
 2525       const er = evalMap && evalMap[rid] ? evalMap[rid] : null;
 2526       if (er){
 2527         const probInp = tr.querySelector('input[list="probabilidad-list"]');
 2528         const consInp = tr.querySelector('input[list="consecuencia-list"]');
 2529         const nivelInp= tr.querySelector('input[name$="_nivel"]');
 2530 
 2531         if (probInp) probInp.value = er.prob_label || valueFromDataId('probabilidad-list', er.id_probabilidad);
 2532         if (consInp) consInp.value = er.cons_label || valueFromDataId('consecuencia-list', er.id_consecuencia);
 2533 
 2534         // llama a tu updateRow para calcular ids ocultos + color de nivel
 2535         if (typeof updateRow === 'function') updateRow(tr);
 2536         else {
 2537           // fallback: setea visibles
 2538           if (nivelInp) nivelInp.value = er.nivel_label || '';
 2539         }
 2540       }
 2541     });
 2542   }
 2543 
 2544   // Limpia secciones “variables” (radios/checkboxes/inputs) antes de hidratar
 2545   function clearDynamic(){
 2546     // radios
 2547     qa('input[type="radio"]').forEach(r => r.checked = false);
 2548     // checkboxes
 2549     qa('input[type="checkbox"]').forEach(c => c.checked = false);
 2550     // textos en bloques variables
 2551     qa('textarea, input[type="text"], input[type="number"], input[type="date"]').forEach(el => {
 2552       // No toques el input de puesto ni el hidden id
 2553       if (el === puestoInput || el === hiddenId) return;
 2554       el.value = '';
 2555     });
 2556   }
 2557 
 2558   // Hidratación principal
 2559   async function hydrateByPuestoId(id){
 2560     if (!id || !fetchBase) return;
 2561     try{
 2562       const res = await fetch(`${fetchBase}/${id}/datos`, { headers: { 'Accept':'application/json' }});
 2563       if (!res.ok) { clearDynamic(); return; }
 2564       const data = await res.json();
 2565 
 2566       // 0) Datos del puesto
 2567       setVal('ptm_num_empleados', data?.puesto?.ptm_num_empleados ?? '');
 2568       setVal('ptm_descripcion_general', data?.puesto?.ptm_descripcion_general ?? '');
 2569       setVal('ptm_actividades_diarias', data?.puesto?.ptm_actividades_diarias ?? '');
 2570       setVal('ptm_objetivo_puesto', data?.puesto?.ptm_objetivo_puesto ?? '');
 2571       const deptoInput = q('input[name="departamento"]');
 2572       if (deptoInput) deptoInput.value = data?.puesto?.departamento ?? '';
 2573 
 2574       // 1) Si no hay identificacion guardada, limpiamos dinámicos y salimos
 2575       if (!data.ident){
 2576         clearDynamic();
 2577         fillQuimicos([]); // deja una fila vacía
 2578         return;
 2579       }
 2580 
 2581       // 2) Limpia y rellena
 2582       clearDynamic();
 2583 
 2584       fillSimpleBlocks(data.ident);
 2585       fillEstadoObs('instalaciones', data.ident.instalaciones);
 2586       fillEstadoObs('maq', data.ident.maq);
 2587       fillEstadoObs('emer', data.ident.emer);
 2588       fillErgo(data.ident.ergo);
 2589       fillCheckMatrix(data.ident.posturas, 'posturas[]');
 2590       fillFuego(data.ident.fuego);
 2591       fillElec(data.ident.elec_select, data.ident.elec_chk);
 2592 
 2593       // Caída mismo nivel
 2594       if (data.ident.caida){
 2595         const c = data.ident.caida;
 2596         ['pisos_adecuados','vias_libres','rampas_identificadas','gradas_barandas','antideslizantes','senalizacion_piso_resbaloso'].forEach(k => {
 2597           const el = q(`input[type="checkbox"][name="caida_nivel[]"][value="${k}"]`);
 2598           if (el) el.checked = !!c[k];
 2599         });
 2600         setVal('caida_observaciones', c.obs || '');
 2601       }
 2602 
 2603       // Químicos
 2604       fillQuimicos(data.quimicos || []);
 2605 
 2606       // Riesgos (aplica/obs + prob/cons/nivel)
 2607       fillRiesgos(data.riesgo_valor || {}, data.evaluacion_riesgo || {});
 2608     } catch(e){
 2609       console.error(e);
 2610     }
 2611   }
 2612 
 2613   // Hook: cuando cambia el puesto o al precargar (si hay ID)
 2614   function onPuestoSelected(){
 2615     const id = hiddenId?.value || '';
 2616     if (id) hydrateByPuestoId(id);
 2617   }
 2618 
 2619   // Ya tenías autollenado básico; agregamos la llamada de edición
 2620   puestoInput?.addEventListener('input', onPuestoSelected);
 2621   puestoInput?.addEventListener('change', onPuestoSelected);
 2622 
 2623   // Si la página viene con $id_puesto_trabajo_matriz, llena al cargar
 2624   if (hiddenId?.value) hydrateByPuestoId(hiddenId.value);
 2625 });
 2626 </script>
 2627 
 2628 </body>
 2629 </html>
